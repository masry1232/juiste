(window.webpackJsonp=window.webpackJsonp||[]).push([[157],{1338:function(e,t){!function(){var t,r={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],AM:"AM",PM:"PM",am:"am",pm:"pm",formats:{D:"%m/%d/%y",F:"%Y-%m-%d",R:"%H:%M",T:"%H:%M:%S",X:"%T",c:"%a %b %d %X %Y",r:"%I:%M:%S %p",v:"%e-%b-%Y",x:"%D"}},s=new function e(t,s,i){var n,o=t||r,a=s||0,c=i||!1,l=0;var u=function(e,t){var r;if(t)r=t.getTime(),c&&(t=new Date(t.getTime()+b(t)+a));else{var s=Date.now();s>l?(l=s,n=new Date(l),r=l,c&&(n=new Date(l+b(n)+a))):r=l,t=n}return function e(t,r,s,i){for(var n="",o=null,l=!1,u=t.length,d=!1,b=0;b<u;b++){var y=t.charCodeAt(b);if(!0!==l)37!==y?n+=t[b]:l=!0;else{if(45===y){o="";continue}if(95===y){o=" ";continue}if(48===y){o="0";continue}if(58===y){d&&"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn("[WARNING] detected use of unsupported %:: or %::: modifiers to strftime"),d=!0;continue}switch(y){case 65:n+=s.days[r.getDay()];break;case 66:n+=s.months[r.getMonth()];break;case 67:n+=h(Math.floor(r.getFullYear()/100),o);break;case 68:n+=e(s.formats.D,r,s,i);break;case 70:n+=e(s.formats.F,r,s,i);break;case 72:n+=h(r.getHours(),o);break;case 73:n+=h(p(r.getHours()),o);break;case 76:n+=m(Math.floor(i%1e3));break;case 77:n+=h(r.getMinutes(),o);break;case 80:n+=r.getHours()<12?s.am:s.pm;break;case 82:n+=e(s.formats.R,r,s,i);break;case 83:n+=h(r.getSeconds(),o);break;case 84:n+=e(s.formats.T,r,s,i);break;case 85:n+=h(f(r,"sunday"),o);break;case 87:n+=h(f(r,"monday"),o);break;case 88:n+=e(s.formats.X,r,s,i);break;case 89:n+=r.getFullYear();break;case 90:if(c&&0===a)n+="GMT";else{var v=r.toString().match(/\(([\w\s]+)\)/);n+=v&&v[1]||""}break;case 97:n+=s.shortDays[r.getDay()];break;case 98:n+=s.shortMonths[r.getMonth()];break;case 99:n+=e(s.formats.c,r,s,i);break;case 100:n+=h(r.getDate(),o);break;case 101:n+=h(r.getDate(),null==o?" ":o);break;case 104:n+=s.shortMonths[r.getMonth()];break;case 106:var w=new Date(r.getFullYear(),0,1),I=Math.ceil((r.getTime()-w.getTime())/864e5);n+=m(I);break;case 107:n+=h(r.getHours(),null==o?" ":o);break;case 108:n+=h(p(r.getHours()),null==o?" ":o);break;case 109:n+=h(r.getMonth()+1,o);break;case 110:n+="\n";break;case 111:n+=String(r.getDate())+g(r.getDate());break;case 112:n+=r.getHours()<12?s.AM:s.PM;break;case 114:n+=e(s.formats.r,r,s,i);break;case 115:n+=Math.floor(i/1e3);break;case 116:n+="\t";break;case 117:I=r.getDay();n+=0===I?7:I;break;case 118:n+=e(s.formats.v,r,s,i);break;case 119:n+=r.getDay();break;case 120:n+=e(s.formats.x,r,s,i);break;case 121:n+=(""+r.getFullYear()).slice(2);break;case 122:if(c&&0===a)n+=d?"+00:00":"+0000";else{var O,E=(O=0!==a?a/6e4:-r.getTimezoneOffset())<0?"-":"+",T=d?":":"",_=Math.floor(Math.abs(O/60)),S=Math.abs(O%60);n+=E+h(_)+T+h(S)}break;default:n+=t[b]}o=null,l=!1}}return n}(e,t,o,r)};return u.localize=function(t){return new e(t||o,a,c)},u.timezone=function(t){var r=a,s=c,i=typeof t;"number"!==i&&"string"!==i||(s=!0,"string"===i?r=("-"===t[0]?-1:1)*(60*parseInt(t.slice(1,3),10)+parseInt(t.slice(3,5),10))*60*1e3:"number"===i&&(r=60*t*1e3));return new e(o,r,s)},u.utc=function(){return new e(o,a,!0)},u}(r,0,!1),i=void 0!==e;i?(t=e.exports=l).strftime=u:(t=function(){return this||(0,eval)("this")}()).strftime=l;var n=i?"require('strftime')":"strftime",o={};function a(e,t){o[e]||("undefined"!=typeof console&&"function"==typeof console.warn&&console.warn("[WARNING] "+e+" is deprecated and will be removed in version 1.0. Instead, use `"+t+"`."),o[e]=!0)}function c(e){e.localize=s.localize.bind(s),e.timezone=s.timezone.bind(s),e.utc=s.utc.bind(s)}function l(e,t,r){return t&&t.days&&(r=t,t=void 0),r&&a("`"+n+"(format, [date], [locale])`","var s = "+n+".localize(locale); s(format, [date])"),(r?s.localize(r):s)(e,t)}function u(e,t,r){return r?a("`"+n+".strftime(format, [date], [locale])`","var s = "+n+".localize(locale); s(format, [date])"):a("`"+n+".strftime(format, [date])`",n+"(format, [date])"),(r?s.localize(r):s)(e,t)}t.strftimeTZ=function(e,t,r,i){"number"!=typeof r&&"string"!=typeof r||null!=i||(i=r,r=void 0);r?a("`"+n+".strftimeTZ(format, date, locale, tz)`","var s = "+n+".localize(locale).timezone(tz); s(format, [date])` or `var s = "+n+".localize(locale); s.timezone(tz)(format, [date])"):a("`"+n+".strftimeTZ(format, date, tz)`","var s = "+n+".timezone(tz); s(format, [date])` or `"+n+".timezone(tz)(format, [date])");return(r?s.localize(r):s).timezone(i)(e,t)},t.strftimeUTC=function(e,t,r){r?a("`"+n+".strftimeUTC(format, date, locale)`","var s = "+n+".localize(locale).utc(); s(format, [date])"):a("`"+n+".strftimeUTC(format, [date])`","var s = "+n+".utc(); s(format, [date])");return(r?d.localize(r):d)(e,t)},t.localizedStrftime=function(e){return a("`"+n+".localizedStrftime(locale)`",n+".localize(locale)"),s.localize(e)},c(l),c(u);var d=s.utc();function h(e,t){return""===t||e>9?e:(null==t&&(t="0"),t+e)}function m(e){return e>99?e:e>9?"0"+e:"00"+e}function p(e){return 0===e?12:e>12?e-12:e}function f(e,t){t=t||"sunday";var r=e.getDay();"monday"===t&&(0===r?r=6:r--);var s=Date.UTC(e.getFullYear(),0,1),i=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),n=(Math.floor((i-s)/864e5)+7-r)/7;return Math.floor(n)}function g(e){var t=e%10,r=e%100;if(r>=11&&r<=13||0===t||t>=4)return"th";switch(t){case 1:return"st";case 2:return"nd";case 3:return"rd"}}function b(e){return 6e4*(e.getTimezoneOffset()||0)}"function"!=typeof Date.now&&(Date.now=function(){return+new Date})}()},1339:function(e,t,r){"use strict";(function(e){
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=function(){return(r=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};var s=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},n="object"==typeof i&&i&&i.Object===Object&&i,o="object"==typeof self&&self&&self.Object===Object&&self,a=n||o||Function("return this")(),c=function(){return a.Date.now()},l=a.Symbol,u=Object.prototype,d=u.hasOwnProperty,h=u.toString,m=l?l.toStringTag:void 0;var p=function(e){var t=d.call(e,m),r=e[m];try{e[m]=void 0;var s=!0}catch(e){}var i=h.call(e);return s&&(t?e[m]=r:delete e[m]),i},f=Object.prototype.toString;var g=function(e){return f.call(e)},b=l?l.toStringTag:void 0;var y=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":b&&b in Object(e)?p(e):g(e)};var v=function(e){return null!=e&&"object"==typeof e};var w=function(e){return"symbol"==typeof e||v(e)&&"[object Symbol]"==y(e)},I=/^\s+|\s+$/g,O=/^[-+]0x[0-9a-f]+$/i,E=/^0b[01]+$/i,T=/^0o[0-7]+$/i,_=parseInt;var S=function(e){if("number"==typeof e)return e;if(w(e))return NaN;if(s(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=s(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(I,"");var r=E.test(e);return r||T.test(e)?_(e.slice(2),r?2:8):O.test(e)?NaN:+e},k=Math.max,A=Math.min;var P=function(e,t,r){var i,n,o,a,l,u,d=0,h=!1,m=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var r=i,s=n;return i=n=void 0,d=t,a=e.apply(s,r)}function g(e){return d=e,l=setTimeout(y,t),h?f(e):a}function b(e){var r=e-u;return void 0===u||r>=t||r<0||m&&e-d>=o}function y(){var e=c();if(b(e))return v(e);l=setTimeout(y,function(e){var r=t-(e-u);return m?A(r,o-(e-d)):r}(e))}function v(e){return l=void 0,p&&i?f(e):(i=n=void 0,a)}function w(){var e=c(),r=b(e);if(i=arguments,n=this,u=e,r){if(void 0===l)return g(u);if(m)return l=setTimeout(y,t),f(u)}return void 0===l&&(l=setTimeout(y,t)),a}return t=S(t)||0,s(r)&&(h=!!r.leading,o=(m="maxWait"in r)?k(S(r.maxWait)||0,t):o,p="trailing"in r?!!r.trailing:p),w.cancel=function(){void 0!==l&&clearTimeout(l),d=0,i=u=n=l=void 0},w.flush=function(){return void 0===l?a:v(c())},w};var D=function(e,t,r){var i=!0,n=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return s(r)&&(i="leading"in r?!!r.leading:i,n="trailing"in r?!!r.trailing:n),P(e,t,{leading:i,maxWait:t,trailing:n})},C=["scroll","resize"],j=["wheel","keydown","keyup","mousedown","mousemove","touchstart","touchmove","click","contextmenu"],N=function(){function e(e){var t=e.timeIntervalEllapsedCallbacks,s=void 0===t?[]:t,i=e.absoluteTimeEllapsedCallbacks,n=void 0===i?[]:i,o=e.checkCallbacksIntervalMs,a=void 0===o?100:o,c=e.browserTabInactiveCallbacks,l=void 0===c?[]:c,u=e.idleCallbacks,d=void 0===u?[]:u,h=e.stopTimerOnTabchange,m=void 0===h||h,p=e.activeCallbacks,f=void 0===p?[]:p,g=e.browserTabActiveCallbacks,b=void 0===g?[]:g,y=e.idleTimeoutMs,v=void 0===y?3e3:y,w=this;this.onBrowserTabInactive=function(){w.isRunning()&&w.stopTimerOnTabchange&&w.stopTimer(),w.browserTabInactiveCallbacks.forEach((function(e){return e(w.getTimeInMilliseconds())}))},this.onBrowserTabActive=function(){w.isRunning()||w.startTimer(),w.browserTabActiveCallbacks.forEach((function(e){return e(w.getTimeInMilliseconds())}))},this.onBrowserActiveChange=function(){"visible"===document.visibilityState?w.onBrowserTabActive():w.onBrowserTabInactive()},this.onTimePassed=function(){w.absoluteTimeEllapsedCallbacks.forEach((function(e,t){var r=e.callback,s=e.pending,i=e.timeInMilliseconds;s&&i<=w.getTimeInMilliseconds()&&(r(w.getTimeInMilliseconds()),w.absoluteTimeEllapsedCallbacks[t].pending=!1)})),w.timeIntervalEllapsedCallbacks.forEach((function(e,t){var r=e.callback,s=e.timeInMilliseconds,i=e.multiplier;s<=w.getTimeInMilliseconds()&&(r(w.getTimeInMilliseconds()),w.timeIntervalEllapsedCallbacks[t].timeInMilliseconds=i(s))})),w.currentIdleTimeMs>=w.idleTimeoutMs&&w.isRunning()?(w.idle=!0,w.stopTimer(),w.idleCallbacks.forEach((function(e){return e(w.getTimeInMilliseconds())}))):w.currentIdleTimeMs+=w.checkCallbacksIntervalMs},this.resetIdleTime=function(){w.idle&&w.startTimer(),w.activeCallbacks.forEach((function(e){return e(w.getTimeInMilliseconds())})),w.idle=!1,w.currentIdleTimeMs=0},this.registerEventListeners=function(){var e={passive:!0},t=r({},e,{capture:!0});document.addEventListener("visibilitychange",w.onBrowserActiveChange);var s=D(w.resetIdleTime,2e3,{leading:!0,trailing:!1});C.forEach((function(e){window.addEventListener(e,s,t)})),j.forEach((function(t){return document.addEventListener(t,s,e)}))},this.unregisterEventListeners=function(){document.removeEventListener("visibilitychange",w.onBrowserActiveChange),C.forEach((function(e){return window.removeEventListener(e,w.resetIdleTime)})),j.forEach((function(e){return document.removeEventListener(e,w.resetIdleTime)}))},this.checkCallbacksOnInterval=function(){w.checkCallbackIntervalId=window.setInterval((function(){w.onTimePassed()}),w.checkCallbacksIntervalMs)},this.startTimer=function(){w.checkCallbackIntervalId||w.checkCallbacksOnInterval();var e=w.times[w.times.length-1];e&&null===e.stop||(w.times.push({start:performance.now(),stop:null}),w.running=!0)},this.stopTimer=function(){w.times.length&&(w.times[w.times.length-1].stop=performance.now(),w.running=!1)},this.addTimeIntervalEllapsedCallback=function(e){w.timeIntervalEllapsedCallbacks.push(e)},this.addAbsoluteTimeEllapsedCallback=function(e){w.absoluteTimeEllapsedCallbacks.push(e)},this.addBrowserTabInactiveCallback=function(e){w.browserTabInactiveCallbacks.push(e)},this.addBrowserTabActiveCallback=function(e){w.browserTabActiveCallbacks.push(e)},this.addIdleCallback=function(e){w.idleCallbacks.push(e)},this.addActiveCallback=function(e){w.activeCallbacks.push(e)},this.getTimeInMilliseconds=function(){return w.times.reduce((function(e,t){return t.stop?e+=t.stop-t.start:e+=performance.now()-t.start,e}),0)},this.isRunning=function(){return w.running},this.isIdle=function(){return w.idle},this.reset=function(){w.times=[]},this.destroy=function(){w.unregisterEventListeners(),w.checkCallbackIntervalId&&window.clearInterval(w.checkCallbackIntervalId)},this.running=!1,this.times=[],this.idle=!1,this.currentIdleTimeMs=0,this.marks={},this.measures={},this.stopTimerOnTabchange=m,this.browserTabActiveCallbacks=b,this.browserTabInactiveCallbacks=l,this.checkCallbacksIntervalMs=a,this.idleTimeoutMs=v,this.timeIntervalEllapsedCallbacks=s,this.absoluteTimeEllapsedCallbacks=n,this.idleCallbacks=d,this.activeCallbacks=f,this.registerEventListeners()}return e.prototype.mark=function(e){this.marks[e]||(this.marks[e]=[]),this.marks[e].push({time:this.getTimeInMilliseconds()})},e.prototype.getMarks=function(e){if(!(this.marks[e].length<1))return this.marks[e]},e.prototype.measure=function(e,t,r){var s=this.marks[t],i=s[s.length-1],n=this.marks[r],o=n[n.length-1];this.measures[e]||(this.measures[e]=[]),this.measures[e].push({name:e,startTime:i.time,duration:o.time-i.time})},e.prototype.getMeasures=function(e){if(this.measures[e]||!(this.measures[e].length<1))return this.measures[e]},e}();t.a=N}).call(this,r(202))},1908:function(e,t,r){r(2218),e.exports=r(333)},2218:function(e,t,r){"use strict";r.r(t);var s={};r.r(s),r.d(s,"default",(function(){return $r})),r.d(s,"apdexType",(function(){return O})),r.d(s,"envType",(function(){return g})),r.d(s,"eventType",(function(){return b})),r.d(s,"originType",(function(){return v})),r.d(s,"platformType",(function(){return y})),r.d(s,"tenantType",(function(){return w})),r.d(s,"userType",(function(){return I})),r.d(s,"originTracingType",(function(){return _})),r.d(s,"TypeAheadHelper",(function(){return ss})),r.d(s,"DwellTimeHelper",(function(){return Qr})),r.d(s,"DwellTimeHelperWithBrowserInteraction",(function(){return Zr})),r.d(s,"CompressionRule",(function(){return me})),r.d(s,"ResilienceMechanism",(function(){return rt})),r.d(s,"StopLowPriorityEventDelayReason",(function(){return ye})),r.d(s,"STARGATE_PROXY_PATH",(function(){return Hr})),r.d(s,"perimeterType",(function(){return A})),r.d(s,"aliasType",(function(){return P})),r.d(s,"groupType",(function(){return D}));r(139),r(421),r(330);var i=r(506),n=r.n(i),o=r(1338),a=r.n(o),c=r(97),l=r.n(c),u=r(914),d=r.n(u),h=r(2),m=r.n(h),p=r(96),f=r.n(p);let g=function(e){return e.LOCAL="local",e.DEV="dev",e.STAGING="staging",e.PROD="prod",e}({}),b=function(e){return e.TRACK="track",e.UI="ui",e.OPERATIONAL="operational",e.SCREEN="screen",e.IDENTIFY="identify",e}({}),y=function(e){return e.MAC="mac",e.LINUX="linux",e.WINDOWS="windows",e.DESKTOP="desktop",e.WEB="web",e.MOBILE_WEB="mobileWeb",e}({}),v=function(e){return e.DESKTOP="desktop",e.WEB="web",e}({}),w=function(e){return e.CLOUD_ID="cloudId",e.ORG_ID="orgId",e.OPSGENIE_CUSTOMER_ID="opsgenieCustomerId",e.HALP_TEAM_ID="halpTeamId",e.TRANSACTION_ACCOUNT_ID="transactionAccountId",e.TRELLO_WORKSPACE_ID="trelloWorkspaceId",e.NONE="none",e}({}),I=function(e){return e.ATLASSIAN_ACCOUNT="atlassianAccount",e.HASHED_EMAIL="hashedEmail",e.TRELLO="trello",e.OPSGENIE="opsgenie",e.HALP="halp",e}({}),O=function(e){return e.TRANSITION="transition",e.INITIAL_LOAD="initialLoad",e}({});const E=Object.freeze([y.DESKTOP,y.MAC,y.LINUX,y.WINDOWS]),T=Object.freeze([y.WEB,y.MOBILE_WEB]);let _=function(e){return e.ATL_ORIGIN="atlOrigin",e}({});function S(e){return Object.values(e)}function k(e,t){return Object.values(e).indexOf(t)>-1}let A=function(e){return e.C5="c5",e.COMMERCIAL="commercial",e.FEDRAMP_MODERATE="fedramp-moderate",e.FEDRAMP_HIGH="fedramp-high",e}({}),P=function(e){return{}}(),D=function(e){return e.TRANSACTION_ACCOUNT_ID="transactionAccountId",e}({}),C=function(e){return e.FEDRAMP_MODERATE_SANDBOX="fedramp-moderate-sandbox",e}({});class j{constructor(){m()(this,"_bindEventListeners",()=>{document.addEventListener(this._visibilityChange,this._handleVisibilityChange,!1)}),m()(this,"_handleVisibilityChange",()=>{const e=document[this._hidden];this._isHidden=e,this._callbacks.forEach(t=>t(e))}),this._isHidden=!1,this._callbacks=new Map,this._hidden=void 0,this._visibilityChange=void 0,"undefined"!=typeof document&&(void 0!==document.hidden?(this._isHidden=document.hidden,this._hidden="hidden",this._visibilityChange="visibilitychange"):void 0!==document.msHidden?(this._isHidden=document.msHidden,this._hidden="msHidden",this._visibilityChange="msvisibilitychange"):void 0!==document.webkitHidden&&(this._isHidden=document.webkitHidden,this._hidden="webkitHidden",this._visibilityChange="webkitvisibilitychange"),void 0!==document.addEventListener&&void 0!==this._hidden&&this._bindEventListeners())}addCallback(e,t){if("string"!=typeof e)throw new Error("Invalid name, must be string");if("function"!=typeof t)throw new Error("Invalid callback, must be function");this._callbacks.set(e,t)}removeCallback(e){this._callbacks.has(e)&&this._callbacks.delete(e)}getIsHidden(){return this._isHidden}}class N{constructor(){this._performance=window.performance}clearMarks(...e){this._performance&&this._performance.clearMarks&&this._performance.clearMarks(...e)}mark(...e){this._performance&&this._performance.mark&&this._performance.mark(...e)}getEntriesByName(...e){return this._performance&&this._performance.getEntriesByName?this._performance.getEntriesByName(...e):[]}getTimeOrigin(){return this._performance&&(this._performance.timeOrigin||this._performance.timing)?this._performance.timeOrigin||this._performance.timing.navigationStart:0}now(){return this._performance&&this._performance.now?this._performance.now():Date.now?Date.now():+new Date}isAvailable(){return!!(this._performance&&this._performance.clearMarks&&this._performance.mark&&this._performance.getEntriesByName&&this._performance.timing)}}function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class L{constructor(e,t){if(m()(this,"_getEventKey",({task:e,taskId:t})=>t?`${e}.${t}`:e),m()(this,"_getEventTimingByName",e=>{const t=this._performance.getEntriesByName(e);return t[t.length-1]}),m()(this,"_getApdexFields",e=>{const t=this._getApdexTimings(e),r=this._calculateApdex({duration:t.duration,threshold:e.threshold});return R(R({},t),{},{apdex:r})}),m()(this,"_getApdexTimings",e=>{const t=this._getEventKey(e),r=t+"-start",s=e.startTime||this._getStartTime(e,r),i=e.stopTime||this._getStopTime();return this._cleanApdexState(t),{startTime:s,stopTime:i,duration:i-s}}),m()(this,"_getStartTime",(e,t)=>{let r;const s=this._performance.getTimeOrigin();if(e.type===O.INITIAL_LOAD)r=s;else{r=s+this._getEventTimingByName(t).startTime}return r}),m()(this,"_getStopTime",()=>this._performance.getTimeOrigin()+this._performance.now()),m()(this,"_cleanApdexState",e=>{this._performance.clearMarks(e+"-start"),this._performance.clearMarks(e+"-stop"),this._startedEvents.delete(e)}),m()(this,"_getVisibilityFields",e=>{let t;if(e.type===O.INITIAL_LOAD)t=!this._wasPreviouslyHidden;else if(e.type===O.TRANSITION){const r=this._getEventKey(e);t=this._isActiveEvents.get(r)}return(e.startTime||e.stopTime)&&(t=!this._pageVisibility.getIsHidden()),{isActiveTab:t}}),m()(this,"_calculateApdex",({duration:e,threshold:t=this._threshold})=>{let r;return r=e<=t?1:e<=4*t?.5:0,r}),m()(this,"_validateStartEvent",e=>{if(!e)throw new Error('Missing "event" in Apdex start event');if(!e.task)throw new Error('Missing "task" in Apdex start event');if("string"!=typeof e.task)throw new Error('Invalid "task" in Apdex start event');if(e.taskId&&"string"!=typeof e.taskId)throw new Error('Invalid "taskId" in Apdex start event')}),m()(this,"_validateStopEvent",e=>{if(!e)throw new Error('Missing "event" in Apdex stop event');if(!e.task)throw new Error('Missing "task" in Apdex stop event');if("string"!=typeof e.task)throw new Error('Invalid "task" in Apdex stop event');if(e.taskId&&"string"!=typeof e.taskId)throw new Error('Invalid "taskId" in Apdex stop event');if(!e.type)throw new Error('Missing "type" in Apdex stop event');if(e.type&&!k(O,e.type))throw new Error('Invalid "type" in Apdex stop event');if(e.threshold&&"number"!=typeof e.threshold)throw new Error('Invalid "threshold" in Apdex stop event');if(!e.startTime&&e.type===O.TRANSITION){const t=this._getEventKey(e);if(!this._startedEvents.has(t))throw new Error(`Apdex event transition "${t}" was not started`)}if(e.startTime&&!("number"==typeof e.startTime&&e.startTime>=0))throw new Error('Invalid "startTime" in Apdex stop event');if(e.stopTime&&"number"!=typeof e.stopTime)throw new Error('Invalid "stopTime" in Apdex stop event');if(e.stopTime<=e.startTime)throw new Error('"stopTime" should be greater than "startTime" in Apdex stop event')}),m()(this,"_shouldSendEvent",e=>!!e&&"number"==typeof e.apdex),m()(this,"_sendEvent",(e,t)=>{this._shouldSendEvent(e)&&this._onEvent({source:"ui",action:"readyForUser",actionSubject:"ui",attributes:R(R({},e.additionalAttributes),{},{task:e.task,taskId:e.taskId,type:e.type,threshold:e.threshold||this._threshold,apdex:e.apdex,startTime:e.startTime,stopTime:e.stopTime,duration:e.duration,isActiveTab:e.isActiveTab})},t)}),!e)throw new Error("Missing onEvent callback");if("function"!=typeof e)throw new Error("Invalid onEvent, must be function");if(!(t instanceof j))throw new Error("Invalid pageVisibility, must be PageVisibility class");this._startedEvents=new Map,this._performance=new N,this._onEvent=e,this._threshold=1e3,this._wasPreviouslyHidden=t.getIsHidden(),this._isActiveEvents=new Map,this._pageVisibility=t,this._pageVisibility.addCallback("apdexEvent",e=>{this.onVisibilityChange(!e)})}start(e){if(this._validateStartEvent(e),!this._performance.isAvailable())return;const t=this._getEventKey(e),r=t+"-start";this._startedEvents.set(t,!0),this._isActiveEvents.set(t,!this._pageVisibility.getIsHidden()),this._performance.clearMarks(r),this._performance.mark(r)}getStart(e){if(this._validateStartEvent(e),!this._performance.isAvailable())return;const t=this._getEventKey(e)+"-start";return this._getEventTimingByName(t)}stop(e,t){if(this._validateStopEvent(e),!this._performance.isAvailable())return;const r=this._getApdexFields(e),s=this._getVisibilityFields(e);this._sendEvent(R(R(R({},e),r),s),t)}onVisibilityChange(e){e||(this._wasPreviouslyHidden=!0,Array.from(this._isActiveEvents.keys()).forEach(e=>this._isActiveEvents.set(e,!1)))}}var x=(e,t)=>()=>{if((e=>"function"==typeof e)(e))try{return e()}catch(e){return void console.error(`${t} - ${e instanceof Error?e.message:String(e)}`)}return e};function U(e){return!0==(null!==(t=e)&&"object"==typeof t&&!1===Array.isArray(t))&&"[object Object]"===Object.prototype.toString.call(e);var t}function F(e){if(!1===U(e))return!1;const t=e.constructor;if("function"!=typeof t)return!1;const r=t.prototype;return!1!==U(r)&&"isPrototypeOf"in r}function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function $(e){return{tenantIdType:e.tenantIdType,tenantId:e.tenantId}}function W(e){return{userIdType:e.userIdType}}function G(e){return{orgId:e.orgId}}function K(e){return{workspaceId:e.workspaceId}}function z(e){if(Y(e))return{aliases:e}}function V(e){if(Y(e))return{groups:e}}function Q(e){return e.anonymousId?{anonymousId:e.anonymousId}:{}}function q(e,t){return void 0===t?e:t}function J(e,t){const r=t||{};return{env:q(e.env,r.env),product:q(e.product,r.product),subproduct:q(e.subproduct(),r.subproduct),version:q(e.version,r.version),origin:q(e.origin,r.origin),platform:q(e.platform,r.platform)}}function Y(e){return F(e)&&Object.keys(e).length>0}function X(e,t){return Y(t)?{[e]:t}:void 0}function Z(e){if(Y(e)){return X("containers",function(e){const t={};return Object.keys(e).forEach(r=>{const s=e[r];t[r]={id:s.id,type:s.type}}),t}(e))}}function ee(e,t){return H({containerType:e.containerType,containerId:e.containerId,source:e.source,objectType:e.objectType,objectId:e.objectId,actionSubject:e.actionSubject,action:e.action,actionSubjectId:e.actionSubjectId,attributes:e.attributes,nonPrivacySafeAttributes:e.nonPrivacySafeAttributes,tags:e.tags,highPriority:e.highPriority,eventType:t},Z(e.containers))}function te(e,t,r,s,i,n,o,a,c,l,u,d,h,m,p,f){const g=J(e),y=$(t),v=W(r),w=G(l),I=K(d),O={title:"",path:"",url:"",referrer:"",search:"",eventType:b.SCREEN};return H(H(H(H(H(H(H(H(H(H(H(H({},g),y),v),w),O),function(e){return X("attributes",e)}(s)),function(e){return X("nonPrivacySafeAttributes",e)}(i)),Z(m)),Q(h)),{},{tags:n,tabId:o,sessionId:a,taskSessions:c,pageLoadId:u},I),z(p)),V(f))}function re(e){return`${e.actionSubject} ${e.action}`}function se(e,t,r,s,i,n,o,a,c,l,u,d,h){const m=J(e,function(e){const{env:t,product:r,subproduct:s,version:i,origin:n,platform:o}=e;return{env:t,product:r,subproduct:s,version:i,origin:n,platform:o}}(s)),p=$(t),f=G(c),g=K(u),b=W(r),y=ee(s,i);return H(H(H(H(H(H(H(H(H({},m),p),f),b),y),Q(s)),{},{tabId:n,sessionId:o,taskSessions:a,pageLoadId:l},g),z(d)),V(h))}const ie=(e,t)=>Object.keys(e).reduce((r,s)=>(r[t(e[s],s,e)]=e[s],r),{}),ne=(e,t)=>Object.keys(e).filter(e=>t.indexOf(e)<0).reduce((t,r)=>(t[r]=e[r],t),{}),oe=(e,t)=>{if(e===t)return!0;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(!e||!t||"object"!=typeof e&&"object"!=typeof t)return e===t;if(e.prototype!==t.prototype)return!1;const r=Object.keys(e);return r.length===Object.keys(t).length&&r.every(r=>oe(e[r],t[r]))},ae=(e,t)=>e.reduce((e,r,s,i)=>(e[t(r,s,i)?0:1].push(r),e),[[],[]]),ce=Object.freeze([b.OPERATIONAL,b.TRACK,b.UI]);function le(e){if(e){if(e&&e.constructor!==Object)throw new Error("properties.containers must be an Object");Object.values(e).forEach(e=>function(e){if(!F(e))throw new Error("properties.containers must be an Object");if(!("id"in e))throw new Error("properties.containers is missing field 'id'");if("string"!=typeof e.id)throw new Error("properties.containers.id must be of type String");if("type"in e&&"string"!=typeof e.type)throw new Error("properties.containers.type must be of type String")}(e))}}function ue(e){switch(e){case b.OPERATIONAL:case b.TRACK:case b.UI:return!0;default:return!1}}function de(e){if(!e)throw new Error("Missing event");if(!e.source)throw new Error("Missing event.source");if(!e.actionSubject)throw new Error("Missing event.actionSubject");if(!e.action)throw new Error("Missing event.action");le(e.containers)}function he(e){if(!e)throw new Error("Missing event");if(!e.source)throw new Error("Missing event.source");if(!e.actionSubject)throw new Error("Missing event.actionSubject")}class me{constructor(e,t){if(m()(this,"canCompress",e=>{try{return e&&ue(e.eventType)&&this.predicate(e)}catch(e){return!1}}),m()(this,"compress",e=>{const[t,r]=ae(e,e=>this.canCompress(e)),s=this.compressFn(t);if(!s)throw new Error("No events were returned from the compression function");return s.forEach(e=>{!function(e){if(!ue(e))throw new Error(`Invalid action event type: ${e}, must be one of: [${ce}]`)}(e.eventType),de(e)}),s.concat(r)}),"function"!=typeof e)throw new Error("Invalid predicate, must be a function that accepts an event and returns a boolean");if("function"!=typeof t)throw new Error("Invalid compressFn, must be a function that both accepts and returns an array of events");this.predicate=e,this.compressFn=t}}function pe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class ge{constructor(e=[]){if(m()(this,"canCompress",e=>this.compressionRules.some(t=>t.canCompress(e))),m()(this,"compress",e=>this.createGroups(e).reduce((e,t)=>{const r=this.compressGroup(t);return e.concat(r)},[])),m()(this,"createGroups",e=>e.reduce((e,t)=>{const r=this.compressionRules.find(e=>e.canCompress(t));let s;if(r){const e=ee(t,t.eventType);s=ne(t,Object.keys(e))}const i=e.find(e=>r===e.compressor&&oe(s,e.contextFields));return i?i.events.push(t):e.push({contextFields:s,compressor:r,events:[t]}),e},[])),m()(this,"compressGroup",e=>{if(!e.compressor)return e.events;try{return e.compressor.compress(e.events).map(t=>fe(fe({},t),e.contextFields))}catch(t){return console.warn(`Failed to compress some analytics events. Error: ${t.message}. Sending ${e.events.length} uncompressed events instead`),e.events}}),!Array.isArray(e))throw new Error("Event compressors must be constructed with an array of CompressionRules");if(!e.every(e=>e instanceof me))throw new Error("Event compressors can only be constructed with instances of CompressionRule");this.compressionRules=e}}class be{constructor(e,t){m()(this,"push",(e,t,r,s)=>{this.eventArgs.push({identifier:e,builtEvent:t,context:r,userInfo:s})}),m()(this,"size",()=>this.eventArgs.length),m()(this,"startFlush",()=>{try{this.eventArgs=this.compressEventArgs(this.eventArgs)}catch(e){console.warn(`Failed to perform compression on the delayed analytics events. Error: ${e.message}. Sending ${this.eventArgs.length} uncompressed events instead`)}this.flushNextBatch()}),m()(this,"cancelFlush",()=>{this.flushBatchTimeout&&(clearTimeout(this.flushBatchTimeout),this.flushBatchTimeout=null)}),m()(this,"flushNextBatch",()=>{this.eventArgs.splice(0,7).forEach(e=>this.processFn(e.identifier,e.builtEvent,e.context,e.userInfo)),this.eventArgs.length>0?this.flushBatchTimeout=setTimeout(()=>this.flushNextBatch(),100):this.flushBatchTimeout=null}),m()(this,"compressEventArgs",e=>{const[t,r]=ae(e,e=>this.compressor.canCompress(e.builtEvent)),s=t.reduce((e,t)=>{const r=e.find(e=>oe(e.userInfo,t.userInfo)&&oe(e.context,t.context));return r?r.eventArgs.push(t):e.push({userInfo:t.userInfo,context:t.context,eventArgs:[t]}),e},[]).reduce((e,t)=>{try{const r=t.eventArgs.map(e=>e.builtEvent),s=this.compressor.compress(r).map(e=>({identifier:re(e),builtEvent:e,userInfo:t.userInfo,context:t.context}));return e.concat(s)}catch(e){return console.warn(`Failed to compress some analytics events. Error: ${e.message}. Sending ${t.eventArgs.length} uncompressed events instead`),t.eventArgs}},[]);return r.forEach(e=>s.push(e)),s}),this.processFn=e,this.flushBatchTimeout=null,this.eventArgs=[],this.compressor=new ge(t)}}let ye=function(e){return e.TIMEOUT="timeout",e.MANUAL="manual",e}({});class ve{constructor(e,t){m()(this,"push",(e,t,r,s)=>{this.delayQueue.push(e,t,r,s)}),m()(this,"startLowPriorityEventDelay",(e=1e4,t)=>{if(Number.isNaN(e)||e<=0)throw new Error(`Invalid timeout period: ${e}, must be a number greater than 0`);this.delayTimeout&&clearTimeout(this.delayTimeout);const r=e?Math.min(e,3e4):3e4;this.delayCallback=t,this.delayTimeout=setTimeout(()=>this.stopLowPriorityEventDelay(ye.TIMEOUT),r),this.delayQueue.cancelFlush(),this.isDelaying=!0}),m()(this,"stopLowPriorityEventDelay",(e=ye.MANUAL)=>{var t;this.delayTimeout&&(clearTimeout(this.delayTimeout),this.delayTimeout=void 0),this.delayQueue.startFlush(),this.isDelaying=!1,null===(t=this.delayCallback)||void 0===t||t.call(this,e),this.delayCallback=void 0}),m()(this,"isDelayingLowPriorityEvents",()=>this.isDelaying),this.isDelaying=!1,this.delayQueue=new be(e,t)}}let we=function(e){return e.IN_PROGRESS="inProgress",e.QUEUE="queue",e.RECLAIM_START="reclaimStart",e.RECLAIM_END="reclaimEnd",e.ACK="ack",e}({}),Ie=function(e){return e[e.RECLAIM_TIMEOUT=1e4]="RECLAIM_TIMEOUT",e[e.RECLAIM_WAIT=500]="RECLAIM_WAIT",e[e.RECLAIM_WAIT_THRESHOLD=2e3]="RECLAIM_WAIT_THRESHOLD",e}({});const Oe=(e,t)=>({[we.ACK]:`${e}.${t}.${we.ACK}`,[we.QUEUE]:`${e}.${t}.${we.QUEUE}`,[we.IN_PROGRESS]:`${e}.${t}.${we.IN_PROGRESS}`,[we.RECLAIM_START]:`${e}.${t}.${we.RECLAIM_START}`,[we.RECLAIM_END]:`${e}.${t}.${we.RECLAIM_END}`}),Ee=Object.values(we);function Te(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function _e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Te(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const Se=e=>new Promise(t=>{setTimeout(t,e)}),ke=async(e,t)=>{const{queue:r,inProgress:s}=e.storageKeys,i=JSON.parse(localStorage.getItem(r)||"[]"),n=JSON.parse(localStorage.getItem(s)||"{}"),o=[...i,...Object.entries(n).map(([e,t])=>_e(_e({},t),{},{attemptNumber:t.attemptNumber+1,id:e}))];if(o.length>0){const i=await t(o);if("successful"===i.status)Ae(e.storageKeys);else if("partial"===i.status){const e=o.filter(e=>!i.acceptedItemIds.includes(e.id));return localStorage.removeItem(s),localStorage.setItem(r,JSON.stringify(e)),{fullReclaim:!1}}}else Ae(e.storageKeys);return{fullReclaim:!0}},Ae=e=>{localStorage.removeItem(e.queue),localStorage.removeItem(e.inProgress),localStorage.removeItem(e.reclaimEnd),localStorage.removeItem(e.reclaimStart),localStorage.removeItem(e.ack)};var Pe=async(e,t)=>{if("string"!=typeof e||0===e.length)return{fullReclaims:0,partialReclaims:0,failedReclaims:0};const r=f()(),s=(e=>{try{return Object.keys(localStorage).filter(t=>t.startsWith(e)).map(e=>e.split(".")).filter(t=>{if(3===t.length&&t[0]===e&&t[2]===we.ACK)try{const e=localStorage.getItem(t.join("."));if(e){const t=parseInt(e);return Ie.RECLAIM_TIMEOUT+t<Date.now()}}catch(e){}return!1}).map(e=>e[1])}catch(e){}return[]})(e).map(s=>(async(e,t)=>{const{ack:r,reclaimStart:s,reclaimEnd:i}=e.storageKeys,n=Date.now();if(localStorage.setItem(s,e.reclaimProcessId),localStorage.setItem(r,n.toString()),await Se(Ie.RECLAIM_WAIT),Date.now()>n+Ie.RECLAIM_WAIT_THRESHOLD||localStorage.getItem(s)!==e.reclaimProcessId)throw new Error("Took to long to callback, reclaim abandonded. After reclaimStart.");if(localStorage.setItem(i,e.reclaimProcessId),await Se(Ie.RECLAIM_WAIT),Date.now()>n+Ie.RECLAIM_WAIT_THRESHOLD||localStorage.getItem(s)!==e.reclaimProcessId||localStorage.getItem(i)!==e.reclaimProcessId)throw new Error("Took to long to callback, reclaim abandonded. After reclaimEnd.");return ke(e,t)})({queuePrefix:e,reclaimProcessId:r,storageKeys:Oe(e,s)},t)),i=await Promise.allSettled(s),n=i.filter(e=>"rejected"===e.status),o=i.filter(e=>"fulfilled"===e.status).map(e=>e.value),a=o.filter(e=>e.fullReclaim),c=o.filter(e=>!e.fullReclaim);return{failedReclaims:n.length,partialReclaims:c.length,fullReclaims:a.length}};let De=function(e){return e.INDEXEDDB="indexeddb",e.MEMORY="memory",e}({}),Ce=function(e){return e.IGNORE="ignore",e.ABANDON="abandon",e.EVICT="evict",e}({});class je extends Error{constructor(){super("window.indexeddb is undefined."),Object.setPrototypeOf(this,je.prototype),this.name="NoIndexedDbError"}}class Ne extends Error{constructor(e){super("Event Limit reached. Abandoning write to: "+e),Object.setPrototypeOf(this,Ne.prototype),this.name="AbandonWriteError"}}class Me extends Error{constructor(e){super("Error thrown while processing events in callback: "+(e&&"object"==typeof e&&"toString"in e&&"function"==typeof e.toString&&e.toString()||"string"==typeof e&&e||"Argument passed to CallbackProcessingError was not an Error or string.")),Object.setPrototypeOf(this,Me.prototype),this.name="CallbackProcessingError"}}class Re extends Error{constructor(e,t){super(`Method '${t}' cannot be called with policy '${e}'.`),this.name="InvalidPolicyError"}}const Le=e=>{if(e&&"object"==typeof e&&"name"in e){const t=e;return"string"==typeof t.name&&("AbandonWriteError"===t.name||"CallbackProcessingError"===t.name||"InvalidPolicyError"===t.name)}return!1};var xe=r(21),Ue=r.n(xe);const Fe=(e,t,{id:r,retryAttempts:s,timeToProcessOffset:i})=>({item:e,id:r||f()(),retryAttempts:s||0,timeToBeProcessedAfter:Date.now()+(i||0),namespace:t,timeAdded:Date.now()}),Be=e=>({logger:e.logger||console,useMemory:e.useMemory||!1,maxAttempts:e.maxAttempts||10,maxEventLimit:e.maxEventLimit||5e3}),He=e=>new Promise((t,r)=>{e.onsuccess=e=>{t(e)},e.onerror=e=>{r(e)}}),$e=(e,t)=>{try{"function"==typeof e.commit&&e.commit()}catch(e){throw t.error("Failed to force commit transaction:",e),e}return(e=>new Promise((t,r)=>{e.oncomplete=()=>{t()},e.onerror=e=>{r(e)},e.onabort=e=>{r(e)}}))(e)},We=(e,t)=>{e.onerror=e=>{t.warn("Error thrown from request:",e)}};class Ge{constructor(e,t,r,s){if(m()(this,"deleteOldestNEvents",async(e,t)=>{var r;const s=e.index("namespace-timeAdded"),i=IDBKeyRange.bound([this.namespace,0],[this.namespace,Date.now()]),n=s.getAllKeys(i,t),o=await He(n),a=null==o||null===(r=o.target)||void 0===r?void 0:r.result;if(a&&Array.isArray(a)&&a.length>0)try{const t=a.map(t=>this.deleteItemHandler(e,t));await Promise.all(t)}catch(e){throw this.logger.warn("Failed to delete items from indexeddb.",e),e}}),!(e>0))throw Error("Event Limit has to be set higher than 1");this.eventLimit=e,this.namespace=t,this.logger=r,this.deleteItemHandler=s}async insertItems(e,t,r=Ce.ABANDON){const s=[...t];let i=0;switch(r){case Ce.ABANDON:await this.throwIfNotEnoughSpace(e,t.length);break;case Ce.EVICT:i=await this.evictIfNotEnoughSpace(e,t.length);break;case Ce.IGNORE:await this.calculateHowManyEventsWeCanAdd(e,s)}const n=s.map(t=>He(e.add(t)));return await Promise.all(n),await $e(e.transaction,this.logger),{items:s,numberOfEvictedItems:i}}async throwIfNotEnoughSpace(e,t){const r=await this.calculateFreeSpace(e);if(r<t)throw new Ne(`Not enough space in IndexedDb. Needed ${t} but only had ${r}`)}async evictIfNotEnoughSpace(e,t){const r=await this.calculateFreeSpace(e);if(r<t){const s=t-r;return await this.deleteOldestNEvents(e,s),s}return 0}async calculateHowManyEventsWeCanAdd(e,t){const r=await this.calculateFreeSpace(e);if(r<t.length){const e=t.length-r,s=t.length-e;t.splice(s,e)}}async calculateFreeSpace(e){const t=await this.getCountofEventsInObjectStore(e);return this.eventLimit-t}async getCountofEventsInObjectStore(e){const t=e.index("namespace-timeAdded"),r=IDBKeyRange.bound([this.namespace,0],[this.namespace,Date.now()]),s=t.count(r);return(await He(s)).target.result}}const Ke=["item"],ze=["items"];function Ve(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}class Qe{constructor(e,t={}){if(m()(this,"startDB",async()=>new Promise(async(e,t)=>{if("undefined"!=typeof window){const r=window.setTimeout(()=>{this.logger.warn("IndexedDB timed out."),t(new je)},15e3),s=window.indexedDB.open("analytics-web-client",1);s.onupgradeneeded=e=>{if(0!==e.oldVersion)throw new Error("We cannot upgrade the database. Do not do this.");const t=s.result.createObjectStore("analytics-resilience",{keyPath:"id"});t.createIndex("timeToBeProcessedAfter","timeToBeProcessedAfter",{unique:!1}),t.createIndex("retryAttempts","retryAttempts",{unique:!1}),t.createIndex("timeAdded","timeAdded",{unique:!1}),t.createIndex("namespace-timeAdded",["namespace","timeAdded"],{unique:!1})};try{return await He(s),e(s.result)}catch(e){this.logger.warn("IndexedDB failed to initialise.",e),t(new je)}finally{window.clearTimeout(r)}}else this.logger.warn("IndexedDB failed to initialise. No 'window' object."),t(new je)})),m()(this,"addItem",async(e,t={},r=Ce.ABANDON)=>{const{logger:s,namespace:i}=this,n=Fe(e,i,t),{objectStore:o}=await this.getObjectStoreAndTransaction("readwrite");if(r===Ce.IGNORE)throw new Re(r,"IndexedDbConnector#addItem");try{if(!n.namespace||0===n.namespace.length||"string"!=typeof n.namespace)throw new Error("Namespace not specified");const e=await this.globalEventLimitGuard.insertItems(o,[n],r);if(1===e.items.length)return{item:e.items[0],numberOfEvictedItems:e.numberOfEvictedItems};throw new Error("Incorrect number of items added. Expected: 1, got: "+e.items.length)}catch(e){if(Le(e))throw e;throw s.log("Failed to add item to table",e),new Error("Request to add item to table failed")}}),m()(this,"bulkAddItem",async(e,t=Ce.ABANDON)=>{const{logger:r,namespace:s}=this,i=e.map(e=>{let{item:t}=e,r=Ue()(e,Ke);return Fe(t,s,r)}),{objectStore:n}=await this.getObjectStoreAndTransaction("readwrite");try{return await this.globalEventLimitGuard.insertItems(n,i,t)}catch(e){if(Le(e))throw e;throw r.log("Failed to add item to table",e),new Error("Request to add item to table failed")}}),m()(this,"getItems",async(e=7)=>{const t=e>0?e:7,{logger:r}=this,s=this.options.maxAttempts,{transaction:i,objectStore:n}=await this.getObjectStoreAndTransaction("readwrite"),o=n.index("timeToBeProcessedAfter"),a=IDBKeyRange.upperBound(Date.now()),c=o.openCursor(a),l=await new Promise(async(e,i)=>{const n=[];let o=0;c.onerror=e=>{r.error("Failed to open cursor:",e),i("Failed to open cursor")},c.onsuccess=i=>{const a=i.target.result;if(a){const i=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ve(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},a.value);n.push(i);const c=a.value;if(c.retryAttempts+=1,c.timeToBeProcessedAfter=Date.now()+6e4,c.retryAttempts>=s){++o;const e=a.delete();We(e,r)}else{const e=a.update(c);We(e,r)}n.length<t?a.continue():e({items:n,numberOfDeletedItems:o})}else e({items:n,numberOfDeletedItems:o})}});return await $e(i,this.logger),l}),m()(this,"deleteItems",async e=>{const{transaction:t,objectStore:r}=await this.getObjectStoreAndTransaction("readwrite");try{const s=e.map(e=>this.deleteItem(r,e));await $e(t,this.logger),await Promise.all(s)}catch(e){throw this.logger.warn("Failed to delete items from indexeddb.",e),e}}),m()(this,"getItemCount",async()=>{const{transaction:e,objectStore:t}=await this.getObjectStoreAndTransaction("readonly"),r=t.index("timeToBeProcessedAfter"),s=IDBKeyRange.upperBound(Date.now()),i=r.count(s),n=await He(i);return await $e(e,this.logger),n.target.result}),m()(this,"processItems",async(e,t=7)=>{const r=await this.getItems(t),{items:s}=r,i=Ue()(r,ze);try{const t=await e(s,i),r=s.map(e=>e.id);return await this.deleteItems(r),t}catch(e){throw new Me(e)}}),m()(this,"deleteItem",async(e,t)=>{const{logger:r}=this;try{await He(e.delete(t))}catch(e){throw r.error("Failed to delete item:",t,e),e}}),m()(this,"getObjectStoreAndTransaction",async e=>{const t=(await this.db).transaction("analytics-resilience",e),r=t.objectStore("analytics-resilience");return{transaction:t,objectStore:r}}),this.options=Be(t),this.namespace=e,this.logger=this.options.logger,!window.indexedDB)throw new je;this.db=this.startDB(),this.db.catch(()=>{}),this.globalEventLimitGuard=new Ge(this.options.maxEventLimit,this.namespace,this.logger,this.deleteItem)}storeType(){return De.INDEXEDDB}}class qe{constructor(e,t){if(m()(this,"insertItemsToMemoryStore",(e,t)=>{switch(t){case Ce.ABANDON:return this.handleAbandonIfLimitWillExceedPolicy(e);case Ce.EVICT:return Promise.resolve(this.handleEvictOldestIfLimitExceededPolicy(e));case Ce.IGNORE:return this.handleAddAsManyAsPossible(e)}}),!(e>0))throw Error("Event Limit has to be set higher than 1");this.eventLimit=e,this.memoryItemHandlers=t}async handleAbandonIfLimitWillExceedPolicy(e){if(await this.memoryItemHandlers.getItemCount()+e.length>this.eventLimit)throw new Ne(De.MEMORY);return this.memoryItemHandlers.addItems(e),{items:e,numberOfEvictedItems:0}}handleEvictOldestIfLimitExceededPolicy(e){this.memoryItemHandlers.addItems(e);return{items:e,numberOfEvictedItems:this.memoryItemHandlers.evictEventsIfNeeded(this.eventLimit)}}async handleAddAsManyAsPossible(e){const t=this.eventLimit-await this.memoryItemHandlers.getItemCount(),r=t>e.length?e:e.slice(0,t);return this.memoryItemHandlers.addItems(r),{items:r,numberOfEvictedItems:0}}}const Je=["item"],Ye=["items"];function Xe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Ze(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Xe(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class et{constructor(e,t={}){this.namespace=e,this.memoryStore=[],this.options=Be(t),this.globalEventLimitGuard=new qe(this.options.maxEventLimit,{addItems:this.addItems.bind(this),getItemCount:this.getItemCount.bind(this),evictEventsIfNeeded:this.evictEventsIfNeeded.bind(this)})}async addItem(e,t={},r=Ce.ABANDON){if(r===Ce.IGNORE)throw new Re(r,"IndexedDbConnector#addItem");const s=Fe(e,this.namespace,t),i=await this.globalEventLimitGuard.insertItemsToMemoryStore([s],r);return Promise.resolve({item:i.items[0],numberOfEvictedItems:i.numberOfEvictedItems})}bulkAddItem(e,t=Ce.ABANDON){const r=e.map(e=>{let{item:t}=e,r=Ue()(e,Je);return Fe(t,this.namespace,r)});return this.bulkAddItemWrapperType(r,t)}bulkAddItemWrapperType(e,t=Ce.ABANDON){return Promise.resolve(this.globalEventLimitGuard.insertItemsToMemoryStore(e,t))}getItems(e=7){return Promise.resolve(this.synchronousGetItems(e))}synchronousGetItems(e=7){const t=e>0?e:7,r=Date.now(),s=[],i=[];for(let e of this.memoryStore)if(e.timeToBeProcessedAfter<=r&&(s.push(Ze({},e)),e.timeToBeProcessedAfter+=6e4,e.retryAttempts+=1,e.retryAttempts>=this.options.maxAttempts&&i.push(e)),s.length>=t)break;return i.forEach(e=>{const t=this.memoryStore.indexOf(e);this.memoryStore.splice(t,1)}),{items:s,numberOfDeletedItems:i.length}}deleteItems(e){return this.memoryStore=this.memoryStore.filter(t=>!e.includes(t.id)),Promise.resolve(void 0)}getItemCount(){const e=Date.now(),t=this.memoryStore.filter(t=>t.timeToBeProcessedAfter<=e).length;return Promise.resolve(t)}async processItems(e,t){const r=this.synchronousGetItems(t),{items:s}=r,i=Ue()(r,Ye),n=s.map(e=>e.id);try{const t=await e(s,i);return await this.deleteItems(n),t}catch(e){throw new Me(e)}}storeType(){return De.MEMORY}addItems(e){this.memoryStore.push(...e),this.memoryStore.sort((function(e,t){return e.timeAdded-t.timeAdded}))}evictEventsIfNeeded(e){const t=this.memoryStore.length;if(t>e){const r=t-e;return this.memoryStore.splice(0,r),r}return 0}}var tt=class{constructor(e,t={}){if(this.namespace=e,this.options=Be(t),!e||0===e.length||"string"!=typeof e)throw new Error("Invalid namespace provided");this.resilience=this.getResilienceMechanism(e,t)}getResilienceMechanism(e,t){if(!t.useMemory)try{return new Qe(e,t)}catch(e){var r;if(!(e instanceof je))null===(r=t.logger)||void 0===r||r.warn("Attempted to create IndexedDbResilience but failed. Using memory instead.")}return new et(this.namespace,t)}addItem(e,t,r=Ce.ABANDON){return this.runOrFailOver(()=>this.resilience.addItem(e,t,r))}bulkAddItem(e,t=Ce.ABANDON){return this.runOrFailOver(()=>this.resilience.bulkAddItem(e,t))}getItems(e){return this.runOrFailOver(()=>this.resilience.getItems(e))}deleteItems(e){return this.runOrFailOver(()=>this.resilience.deleteItems(e))}getItemCount(){return this.runOrFailOver(()=>this.resilience.getItemCount())}processItems(e,t){return this.runOrFailOver(()=>this.resilience.processItems(e,t))}storeType(){return this.resilience.storeType()}async runOrFailOver(e){try{return await e()}catch(t){if(Le(t))throw t;return this.resilience.storeType()===De.INDEXEDDB&&await this.failOver(),e()}}async failOver(){const e=this.resilience,t=new et(this.namespace,this.options);this.resilience=t;try{const{items:r}=await e.getItems(this.options.maxEventLimit);if(r.length>0){const s=(await t.bulkAddItemWrapperType(r,Ce.IGNORE)).items.map(e=>e.id);await e.deleteItems(s)}}catch(e){this.options.logger.warn("Unexpected error from ResilienceDb, switching to MemoryDb")}}};let rt=function(e){return e.INDEXEDDB="indexeddb",e.MEMORY="memory",e}({}),st=function(e){return e[e.ONLINE=0]="ONLINE",e[e.OFFLINE=1]="OFFLINE",e}({});class it{constructor(){m()(this,"itemsDiscardedByRetry",0),m()(this,"eventCount",0),m()(this,"itemsDiscardedByOverflow",0),m()(this,"resilienceMechanism",rt.INDEXEDDB),m()(this,"localstorageNumberOfQueuesPurged",0),m()(this,"localstorageNumberOfFullReclaims",0),m()(this,"localstorageNumberOfPartialReclaims",0),m()(this,"localstorageNumberOfFailedReclaims",0)}addToItemsDiscardedByRetryCounter(e=1){this.itemsDiscardedByRetry+=e}addToEventCount(){this.eventCount++}addToItemsDiscardedByOverflowCounter(e=1){this.itemsDiscardedByOverflow+=e}setResilienceMechanism(e){this.resilienceMechanism=e}addToReclaimMetrics(e){this.localstorageNumberOfFullReclaims+=e.fullReclaims,this.localstorageNumberOfPartialReclaims+=e.partialReclaims,this.localstorageNumberOfFailedReclaims+=e.failedReclaims}addToPurgedQueuesMetrics(e){this.localstorageNumberOfQueuesPurged+=e}subtractFromMetrics(e){this.itemsDiscardedByRetry=this.subtractFromCount(this.itemsDiscardedByRetry,e.itemsDiscardedByRetry),this.eventCount=this.subtractFromCount(this.eventCount,e.eventCount),this.itemsDiscardedByOverflow=this.subtractFromCount(this.itemsDiscardedByOverflow,e.itemsDiscardedByOverflow),this.localstorageNumberOfFullReclaims=this.subtractFromCount(this.localstorageNumberOfFullReclaims,e.fullReclaims),this.localstorageNumberOfPartialReclaims=this.subtractFromCount(this.localstorageNumberOfPartialReclaims,e.partialReclaims),this.localstorageNumberOfFailedReclaims=this.subtractFromCount(this.localstorageNumberOfFailedReclaims,e.failedReclaims),this.localstorageNumberOfQueuesPurged=this.subtractFromCount(this.localstorageNumberOfQueuesPurged,e.localstorageQueuesPurged)}subtractFromCount(e,t){return Math.max(e-(t||0),0)}getMetricsPayload(){return{itemsDiscardedByRetry:this.itemsDiscardedByRetry,eventCount:this.eventCount,itemsDiscardedByOverflow:this.itemsDiscardedByOverflow,resilienceMechanism:this.resilienceMechanism,localstorageQueuesPurged:this.localstorageNumberOfQueuesPurged,fullReclaims:this.localstorageNumberOfFullReclaims,partialReclaims:this.localstorageNumberOfPartialReclaims,failedReclaims:this.localstorageNumberOfFailedReclaims}}}let nt=null;var ot=()=>(nt||(nt=new it),nt);class at{constructor(e){"undefined"!=typeof window&&(window.addEventListener("offline",()=>e(st.OFFLINE)),window.addEventListener("online",()=>e(st.ONLINE)))}getNetworkStatus(){return window.navigator.onLine?st.ONLINE:st.OFFLINE}}let ct=function(e){return e.IDLE="idle",e.RUNNING="running",e.COMPLETED="completed",e.TIMED_OUT="timedOut",e}({}),lt=function(e){return e.EXECUTE="execute",e.COMPLETE="complete",e.TIMEOUT="timeout",e}({});class ut{constructor(e){if(m()(this,"timeoutHandle",void 0),m()(this,"callbackStatus",ct.IDLE),!(e>0))throw new Error("CallbackWithTimeout requires timeout period higher than 0");this.timeoutPeriod=e}transitionCallbackStatus(e,t){switch(e){case ct.IDLE:case ct.TIMED_OUT:case ct.COMPLETED:t===lt.EXECUTE&&(this.callbackStatus=ct.RUNNING);break;case ct.RUNNING:switch(t){case lt.COMPLETE:this.callbackStatus=ct.COMPLETED;break;case lt.TIMEOUT:this.callbackStatus=ct.TIMED_OUT}break;default:this.callbackStatus=e}}executeCallbackWithTimeout(e,t,r){"undefined"!=typeof window&&(this.transitionCallbackStatus(this.callbackStatus,lt.EXECUTE),this.timeoutHandle=window.setTimeout(()=>{this.transitionCallbackStatus(this.callbackStatus,lt.TIMEOUT),r()},this.timeoutPeriod),e(e=>{this.cancelTimeout(),this.getCallbackStatus()!==ct.TIMED_OUT&&(this.transitionCallbackStatus(this.callbackStatus,lt.COMPLETE),t(e))}))}getCallbackStatus(){return this.callbackStatus}cancelTimeout(){"undefined"!=typeof window&&this.timeoutPeriod>0&&this.timeoutHandle&&(window.clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0)}}let dt=function(e){return e[e.NOOP=0]="NOOP",e[e.SUCCESS=1]="SUCCESS",e[e.ERROR=2]="ERROR",e}({});const ht=1e3,mt=3e4,pt=2,ft=0,gt=500,bt=5e3;let yt=function(e){return e[e.NONE=0]="NONE",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.WAIT=2]="WAIT",e}({});class vt{constructor(e,t){m()(this,"schedule",({immediate:e}={immediate:!1})=>{"undefined"!=typeof window&&(this.operationInFlight?e?this.queuedSchedule=yt.IMMEDIATE:this.queuedSchedule!==yt.IMMEDIATE&&(this.queuedSchedule=yt.WAIT):(e||this.options.waitInterval<=0)&&0===this.failureCount?(this.clearTimeout(),this.run()):this.failureCount>0&&null===this.scheduledTimeout?this.scheduledTimeout=window.setTimeout(this.run,this.calculateBackoff()):null===this.scheduledTimeout&&(this.scheduledTimeout=window.setTimeout(this.run,this.options.waitInterval)))}),m()(this,"stop",()=>{this.clearTimeout(),this.queuedSchedule=yt.NONE}),m()(this,"getFailureCount",()=>this.failureCount),m()(this,"getCallbackStatus",()=>this.callbackTimer.getCallbackStatus()),m()(this,"clearTimeout",()=>{"undefined"!=typeof window&&null!==this.scheduledTimeout&&(window.clearTimeout(this.scheduledTimeout),this.scheduledTimeout=null)}),m()(this,"run",()=>{this.operationInFlight=!0,this.clearTimeout();try{this.callbackTimer.executeCallbackWithTimeout(this.callback,this.done,()=>this.done(dt.ERROR))}catch(e){this.done(e)}}),m()(this,"done",e=>{this.operationInFlight=!1,e===dt.ERROR||this.callbackTimer.getCallbackStatus()===ct.TIMED_OUT?(this.failureCount++,this.clearTimeout()):e===dt.SUCCESS&&(this.failureCount=0),this.processQueuedSchedule()}),m()(this,"processQueuedSchedule",()=>{if(this.queuedSchedule!==yt.NONE){const e=this.queuedSchedule===yt.IMMEDIATE;this.queuedSchedule=yt.NONE,this.schedule({immediate:e})}else this.failureCount>0&&this.schedule()}),m()(this,"calculateBackoff",()=>{const{minRetryDelay:e,maxRetryDelay:t,backoffFactor:r,backoffJitterPercentage:s}=this.options;let i=e*r**this.failureCount;if(s){const e=Math.random(),t=Math.floor(e*s*i);Math.floor(10*e)<5?i-=t:i+=t}return Number(Math.min(i,t).toPrecision(1))}),this.options={minRetryDelay:e.minRetryDelay||ht,maxRetryDelay:e.maxRetryDelay||mt,backoffFactor:e.backoffFactor||pt,backoffJitterPercentage:e.backoffJitterPercentage||ft,waitInterval:void 0!==e.waitInterval?e.waitInterval:gt,callbackTimeoutPeriod:e.callbackTimeoutPeriod||bt},this.scheduledTimeout=null,this.failureCount=0,this.callback=t,this.operationInFlight=!1,this.queuedSchedule=yt.NONE,this.callbackTimer=new ut(this.options.callbackTimeoutPeriod)}}function wt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function It(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?wt(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const Ot={backoffFactor:0,backoffJitterPercentage:0,flushWaitMs:6e4,minRetryDelay:6e4,maxRetryDelay:6e4},Et=2,Tt=.2,_t=7,St=!1,kt=500,At=10,Pt=1e3,Dt=3e4,Ct=1e3;class jt{constructor(e,t,r,s){this.queuePrefix=e,this.resilience=new tt(t,{logger:s,maxAttempts:null==r?void 0:r.maxAttempts,maxEventLimit:null==r?void 0:r.maxItems}),this.options=this.buildOptions(r),this.scheduler=new vt(It(It({},this.options),{},{waitInterval:null!=r&&r.flushBeforeUnload?0:this.options.flushWaitMs}),this.scheduleCallback.bind(this)),this.longPollingScheduler=new vt(It(It({},Ot),{},{waitInterval:Ot.flushWaitMs}),this.scheduleLongCallBack.bind(this)),this.metricsCollector=ot(),this.networkStatus=new at(e=>{e===st.OFFLINE?this.scheduler.stop():this.checkEventCountAndReschedule()})}start(e){this.batchFlushCallback=e,this.longPollingScheduler.schedule()}stop(){this.scheduler.stop(),this.longPollingScheduler.stop()}async addItem(e){const t=JSON.parse(JSON.stringify(e)),{numberOfEvictedItems:r}=await this.resilience.addItem(t,{},Ce.EVICT);this.scheduler.schedule(),this.metricsCollector.addToEventCount(),r>0&&this.metricsCollector.addToItemsDiscardedByOverflowCounter(r)}getGlobalRetryCount(){return this.scheduler.getFailureCount()}async scheduleCallback(e){if(this.networkStatus.getNetworkStatus()!==st.OFFLINE)try{e(await this.resilience.processItems(this.flush.bind(this),this.options.batchFlushSize))}catch(t){if("CallbackProcessingError"===t.name)return void e(dt.ERROR)}finally{await this.checkEventCountAndReschedule()}else e(dt.NOOP)}async checkEventCountAndReschedule(){const e=await this.resilience.getItemCount();e>0&&this.scheduler.schedule({immediate:e>=this.options.batchFlushSize})}async scheduleLongCallBack(e){const t=(e=>{if("string"!=typeof e||0===e.length)return 0;try{const t=Object.keys(localStorage).filter(t=>t&&t.startsWith(e+".")||!1).map(e=>e.split(".")).filter(e=>3===e.length&&Ee.includes(e[2])).reduce((e,t)=>{const[,r,s]=t;return void 0===e[r]&&(e[r]={}),e[r][s]=!0,e},{}),r=Object.keys(t).filter(e=>!0!==t[e][we.ACK]);return r.forEach(t=>{const{queue:r,inProgress:s,reclaimStart:i,reclaimEnd:n}=Oe(e,t);localStorage.removeItem(s),localStorage.removeItem(r),localStorage.removeItem(i),localStorage.removeItem(n)}),r.length}catch(e){}return 0})(this.queuePrefix);this.metricsCollector.addToPurgedQueuesMetrics(t);const r=await Pe(this.queuePrefix,async e=>{const t=e.map(e=>({item:e.item,retryAttempts:e.attemptNumber,id:e.id})),{items:r}=await this.resilience.bulkAddItem(t,Ce.IGNORE);return r.length===t.length?{status:"successful"}:{status:"partial",acceptedItemIds:r.map(e=>e.id)}});this.metricsCollector.addToReclaimMetrics(r),await this.checkEventCountAndReschedule(),e(dt.SUCCESS),this.longPollingScheduler.schedule()}flush(e,t){this.metricsCollector.setResilienceMechanism(this.resilience.storeType());const{batchFlushCallback:r}=this;if(!r)throw new Error("batchFlushCallback has not been set. Call PullBatchableQueue#start first.");return new Promise((s,i)=>{if(e.length<=0)return void s(dt.NOOP);const n=e.map(e=>{const t=e.item;return e.retryAttempts>0&&t.msg&&(t.msg._metadata||(t.msg._metadata={}),t.msg._metadata.failedAttempts=e.retryAttempts),t});r(n,e=>{e?(t.numberOfDeletedItems>0&&this.metricsCollector.addToItemsDiscardedByRetryCounter(t.numberOfDeletedItems),i(e)):s(dt.SUCCESS)})})}buildOptions(e){return{backoffFactor:(null==e?void 0:e.backoffFactor)||Et,backoffJitterPercentage:void 0!==(null==e?void 0:e.backoffJitterPercentage)?e.backoffJitterPercentage:Tt,batchFlushSize:(null==e?void 0:e.batchFlushSize)||_t,flushBeforeUnload:(null==e?void 0:e.flushBeforeUnload)||St,flushWaitMs:(null==e?void 0:e.flushWaitMs)||kt,maxItems:(null==e?void 0:e.maxItems)||Pt,maxAttempts:(null==e?void 0:e.maxAttempts)||At,maxRetryDelay:(null==e?void 0:e.maxRetryDelay)||Dt,minRetryDelay:(null==e?void 0:e.minRetryDelay)||Ct}}}let Nt=function(e){return e.IDENTIFY="identify",e.PAGE="page",e.TRACK="track",e}({});function Mt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Rt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Mt(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}async function Lt(e,t){try{const r=await t;return e.map(e=>function(e,t){if(!(t&&t instanceof Function))return e;if(e.msg.type===Nt.PAGE||e.msg.type===Nt.TRACK){const r=t();r&&Array.isArray(r)&&(e.msg.properties=Rt(Rt({},e.msg.properties),{},{xid:r}))}else if(e.msg.traits&&e.msg.type===Nt.IDENTIFY){const r=t();r&&Array.isArray(r)&&(e.msg.traits=Rt(Rt({},e.msg.traits),{},{xid:r}))}return e}(e,r))}catch(t){return e}}var xt=r(92);function Ut(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}const Ft=async e=>{var t;const r=null===(t=Bt(e))||void 0===t?void 0:t.signal,s=Ht(e.url),i=await fetch(e.url,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ut(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ut(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(e.batch),signal:r},s));if(429===i.status||i.status>=500&&i.status<600)throw new Error(`HTTP Error ${i.status} (${i.statusText})`);return i},Bt=e=>{if(e.abortController)return e.abortController;if(e.timeout){const t=new AbortController;return setTimeout(()=>{t.abort()},e.timeout),t}},Ht=Object(xt.a)(e=>new URL(e).origin===location.origin?{}:{mode:"cors",credentials:"include"});var $t=r(701),Wt=r(116),Gt=r.n(Wt);let Kt=function(e){return e.AWC_TLD_TEST="AWC_TLD_TEST",e.AWC_ANALYTICS_DEBUG="AWC_ANALYTICS_DEBUG",e.AJS_ANONYMOUS_ID="AJS_ANONYMOUS_ID",e}({});class zt{constructor(e,t){this.key=e,this.options=t}getAttributes(){return this.options}getKey(){return this.key}}const Vt={[Kt.AWC_TLD_TEST]:new zt("__awc_tld_test__",{expires:365,secure:"https:"===window.location.protocol,path:"/"}),[Kt.AWC_ANALYTICS_DEBUG]:new zt("atlassian_analytics_debug",{expires:365,secure:"https:"===window.location.protocol,path:"/"}),[Kt.AJS_ANONYMOUS_ID]:new zt("ajs_anonymous_id",{expires:365,secure:"https:"===window.location.protocol,path:"/"})};var Qt=new class{constructor(){m()(this,"_data",{}),m()(this,"length",0),m()(this,"setItem",(e,t)=>(this._data[e]=t,this.length=Object.keys(this._data).length,t)),m()(this,"getItem",e=>e in this._data?this._data[e]:null),m()(this,"removeItem",e=>(e in this._data&&delete this._data[e],this.length=Object.keys(this._data).length,null)),m()(this,"clear",()=>{this._data={},this.length=0}),m()(this,"key",e=>Object.keys(this._data)[e])}};function qt(e){if(!e)return!1;try{const t="awc.storage.support";e.setItem(t,"test_value");const r=e.getItem(t);return e.removeItem(t),"test_value"===r}catch(e){return!1}}class Jt{constructor(e,t={}){m()(this,"getStore",()=>this._store),m()(this,"getItem",e=>this._store.getItem(this.createKey(e))),m()(this,"removeItem",e=>this._store.removeItem(this.createKey(e))),m()(this,"setItem",(e,t)=>{try{this._store.setItem(this.createKey(e),t)}catch(r){(function(e){let t=!1;if(e.code)switch(e.code){case 22:t=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===e.name&&(t=!0)}else-2147024882===e.number&&(t=!0);return t})(r)&&(this.swapToInMemory(),this._store.setItem(this.createKey(e),t))}}),m()(this,"swapToInMemory",()=>{if(this._store===Qt||"undefined"==typeof window)return;const e=Object.keys(this._store||{});let t;qt(window.awcInMemoryStorageFallback)?t=window.awcInMemoryStorageFallback:(t=Qt,window.awcInMemoryStorageFallback||(window.awcInMemoryStorageFallback=Qt)),e.forEach(e=>{if(0===e.indexOf(this.getPrefix())){const r=this._store.getItem(e);r&&t.setItem(e,r)}}),this._store=t}),m()(this,"clear",()=>this._store.clear()),m()(this,"key",e=>this._store.key(e)),m()(this,"getPrefix",()=>this._prefix),m()(this,"createKey",e=>this._prefix?`${this.getPrefix()}.${e}`:e),this.options=t;const r=[];(void 0===t.useStoragePrefix||t.useStoragePrefix)&&r.push("awc"),t.envPrefix&&t.envPrefix!==g.PROD&&r.push(t.envPrefix),this._prefix=r.join("-"),qt(e)?this._store=e:this.swapToInMemory()}}var Yt=class extends Jt{constructor(e){let t;try{t=window.localStorage||Qt}catch(e){t=Qt}super(t,e)}};class Xt{constructor(){this.safeStorage=new Yt({useStoragePrefix:!1})}set(e,t){return this.safeStorage.setItem(e,t),t}get(e){return this.safeStorage.getItem(e)||void 0}remove(e){this.safeStorage.removeItem(e)}}const Zt=Vt.AWC_TLD_TEST.getKey(),er=Object(xt.a)(()=>{if("undefined"==typeof location)return"";const{hostname:e}=location,t=e.split(".");for(let e=1;e<=t.length;e++){const r="."+t.slice(-1*e).join(".");if(Gt.a.set(Zt,"tld_test",{domain:r}),"tld_test"===Gt.a.get(Zt))return Gt.a.remove(Zt,{domain:r}),r}return e});function tr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function rr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tr(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class sr{constructor(e){this.cookieLike=((e=!1)=>!e&&!("file:"===location.protocol||"chrome-extension:"===location.protocol))(e)?Gt.a:new Xt}set(e,t,r){if(Vt[e])return this.cookieLike.set(Vt[e].getKey(),t,rr(rr({},Vt[e].getAttributes()),{},{domain:er()},r));console.warn(`Unknown cookie key ${e} provided, not set.`)}get(e){if(Vt[e])return this.cookieLike.get(Vt[e].getKey());console.warn(`Unknown cookie key ${e} provided, not fetched.`)}remove(e,t){Vt[e]?this.cookieLike.remove(Vt[e].getKey(),rr({},t)):console.warn(`Unknown cookie key ${e} provided, not removed.`)}}class ir{constructor(e){this.store=new Yt({useStoragePrefix:!1}),this.cookie=new sr(e)}getUserId(){return this.userId||null}setUserId(e){this.userId=e}getAnonymousId(e){return this.getAnonymousIdFromLocalStorageAndUpdateCookieIfStale()||this.getAnonymousIdFromCookieAndUpdateLocalStorage()||this.generateNewAnonymousId(e)}setAnonymousId(e){const t=JSON.stringify(e);return this.cookie.set(Kt.AJS_ANONYMOUS_ID,t),this.lastAnonymousIdCookieUpdate=Date.now(),this.store.setItem(Vt.AJS_ANONYMOUS_ID.getKey(),t)}getAnonymousIdFromStorage(e){const t="LOCAL_STORAGE"===e?this.store.getItem(Vt.AJS_ANONYMOUS_ID.getKey()):this.cookie.get(Kt.AJS_ANONYMOUS_ID);if(t){const e={type:"UNSAFE",anonymousId:t};try{const r=JSON.parse(t);return r&&"string"==typeof r?{type:"SAFE",anonymousId:r}:e}catch(t){return e}}return{type:"NOT_FOUND"}}getAnonymousIdFromLocalStorageAndUpdateCookieIfStale(){const e=this.getAnonymousIdFromStorage("LOCAL_STORAGE");let t=!1;switch((!this.lastAnonymousIdCookieUpdate||Object($t.a)(new Date,new Date(this.lastAnonymousIdCookieUpdate))>=7)&&(t=!0),e.type){case"SAFE":return t&&this.setAnonymousId(e.anonymousId),e.anonymousId;case"UNSAFE":return e.anonymousId;case"NOT_FOUND":default:return null}}getAnonymousIdFromCookieAndUpdateLocalStorage(){const e=this.getAnonymousIdFromStorage("COOKIE");switch(e.type){case"SAFE":case"UNSAFE":return this.store.setItem(Vt.AJS_ANONYMOUS_ID.getKey(),JSON.stringify(e.anonymousId)),e.anonymousId;case"NOT_FOUND":default:return null}}generateNewAnonymousId(e=f.a){const t=e();return this.setAnonymousId(t),t}}var nr=r(702),or=r.n(nr);function ar(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function cr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ar(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ar(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const lr=e=>{const t=ur(e);return or()(t)},ur=e=>{if(null===e||"object"!=typeof e)return e;const t={};return Object.keys(e).forEach(r=>{const s=dr(e,r);void 0!==s&&(Array.isArray(s)?t[r]=s.map(e=>ur(e)):t[r]="object"==typeof s&&null!==s?ur(s):s)}),t},dr=(e,t)=>e[t];function hr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function mr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?hr(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class pr{constructor(e){var t;m()(this,"sendEvents",async(e,t)=>{const r=this.resilienceQueue.getGlobalRetryCount(),s=this.metrics.getMetricsPayload(),i=mr(mr({},s),{},{httpRetryCount:r});for(let e in i)0===i[e]&&delete i[e];const n=await this.attachXIDs(e),o=(new Date).toISOString(),a={batch:n.map(e=>(e.msg.sentAt=o,e.msg)),sentAt:o,metadata:i};try{const e=await Ft({url:this.gasv3BatchUrl,batch:a,timeout:this.options.requestTimeout});this.metrics.subtractFromMetrics(s),t(null,e)}catch(e){t(e,null)}}),this.options=mr(mr({},e),{},{requestTimeout:e.requestTimeout||1e4,retryQueueOptions:e.retryQueueOptions||{},logger:e.logger||console,disableCookiePersistence:e.disableCookiePersistence||!1}),this.user=new ir(null===(t=this.options)||void 0===t?void 0:t.disableCookiePersistence),this.xidPromiseCallback=e.xidPromiseGetter(),this.gasv3BatchUrl=`${e.apiHostProtocol}://${e.apiHost}/batch`,this.metrics=ot(),this.resilienceQueue=((e,t,r,s)=>new jt(e,t,r||{},s))(e.retryQueuePrefix,e.product,this.options.retryQueueOptions,this.options.logger),this.resilienceQueue.start(this.sendEvents)}getUser(){return this.user}async track(e,t,r,s){const i=mr(mr({},this.buildBaseEvent(r,Nt.TRACK,t)),{},{type:Nt.TRACK,properties:lr(t),event:e}),n=mr(mr({},i),{},{messageId:this.createMessageId()}),o=this.packageEvent(n);await this.resilienceQueue.addItem(o),s&&s()}async page(e,t,r,s){const i=mr(mr({},this.buildBaseEvent(r,Nt.PAGE,t)),{},{type:Nt.PAGE,properties:lr(t),name:e}),n=mr(mr({},i),{},{messageId:this.createMessageId()}),o=this.packageEvent(n);await this.resilienceQueue.addItem(o),s&&s()}async identify(e,t,r,s){const i=mr(mr({},this.buildBaseEvent(r,Nt.IDENTIFY,t)),{},{type:Nt.IDENTIFY,traits:lr(t)}),n=mr(mr({},i),{},{messageId:this.createMessageId()}),o=this.packageEvent(n);await this.resilienceQueue.addItem(o),s&&s()}buildBaseEvent(e,t,r){return{context:(e=>cr(cr({},e.context),{},{userAgent:navigator.userAgent}))(lr(e)),timestamp:(new Date).toISOString(),type:t,userId:this.user.getUserId(),anonymousId:r.anonymousId||this.user.getAnonymousId()}}createMessageId(){return"ajs-"+f()()}packageEvent(e){const{apiHost:t,apiHostProtocol:r}=this.options;return{headers:{"Content-Type":"text/plain"},msg:e,url:`${r}://${t}/${e.type.charAt(0)}`}}async attachXIDs(e){return this.xidPromiseCallback?Lt(e,this.xidPromiseCallback):Promise.resolve(e)}}var fr=r(508);const gr=e=>window.history.replaceState({},"",e);var br=(e,t=gr)=>{const r=window.location.href,s=window.location.hash,i=""!==s?r.replace(s,""):r,{url:n,query:o}=Object(fr.parseUrl)(i),a=(c=o,l=e,Object.keys(c).filter(e=>l(c[e],e)).reduce((e,t)=>(e[t]=c[t],e),{}));var c,l;if(Object.keys(a).length>0){const r=((e,t)=>Object.keys(e).filter(r=>!t(e[r],r)).reduce((t,r)=>(t[r]=e[r],t),{}))(o,e);if(Object.keys(r).length>0){t(`${n}?${Object(fr.stringify)(r)}${s}`)}else t(`${n}${s}`)}return a};class yr{constructor(){m()(this,"handleOriginParameters",(e,t)=>{const r=Object.keys(e);if(!(r.length>0))throw new Error("Empty parameter mapping provided");const s=r.filter(e=>Object.values(_).indexOf(e)<0);if(s.length>0)throw new Error(`Invalid Origin Tracing Parameter(s) supplied: ${s.join()}!`);const i=br((e,t)=>r.indexOf(t)>=0,t);return Object.keys(i).map(t=>({[t]:e[t](i[t])})).reduce((e,t)=>Object.assign(e,t),{})}),this._originStore={}}}const vr=({useStargate:e,env:t,useLegacyUrl:r,envOverride:s})=>{if(t===g.LOCAL||t===g.DEV)throw Error("No LOCAL or DEV environments for FedRAMP.");if(t===g.PROD&&s)throw Error("Cannot override to FedRAMP Sandbox for Prod.");return e?r?t===g.PROD?"api.atlassian-us-gov-mod.com/gasv3/api/v1":(e=>e&&e===C.FEDRAMP_MODERATE_SANDBOX?"api-private.atlassian-fex.com/gasv3/api/v1":"api.stg.atlassian-us-gov-mod.com/gasv3/api/v1")(s):window.location.host+"/gateway/api/gasv3/api/v1":t===g.PROD?"as.atlassian-us-gov-mod.com/api/v1":(e=>e&&e===C.FEDRAMP_MODERATE_SANDBOX?"as.atlassian-fex.com/api/v1":"as.staging.atl-paas-us-gov-mod.net/api/v1")(s)};function wr({useStargate:e,env:t,useLegacyUrl:r,perimeter:s,envOverride:i}){return s===A.FEDRAMP_MODERATE?vr({useStargate:e,env:t,useLegacyUrl:r,envOverride:i}):(({useStargate:e,env:t,useLegacyUrl:r})=>e?r?t===g.PROD?"api-private.atlassian.com/gasv3/api/v1":"api-private.stg.atlassian.com/gasv3/api/v1":window.location.host+"/gateway/api/gasv3/api/v1":t===g.PROD?"as.atlassian.com/api/v1":"as.staging.atl-paas.net/api/v1")({useStargate:e,env:t,useLegacyUrl:r})}const Ir=/^\d+$/,Or=()=>{};class Er{constructor(e={}){m()(this,"_generateNewSessionId",()=>{const e=Date.now().toString();return this._safeLocalStorage.setItem("session.id",e),this._onNewSessionStarted&&this._onNewSessionStarted(),e}),m()(this,"_updateSessionExpiry",()=>{const e=Date.now()+this._sessionExpiryTime;return this._safeLocalStorage.setItem("session.expiry",e.toString()),e}),m()(this,"_debouncedUpdateSessionExpiry",e=>{const{_updateSessionExpiry:t}=this;if(e<Date.now()+this._sessionExpiryDebounceThresholdPercentage*this._sessionExpiryTime)return t();this._sessionExpiryDebounceTimer&&clearTimeout(this._sessionExpiryDebounceTimer),this._sessionExpiryDebounceTimer=setTimeout(()=>{t()},this._sessionExpiryDebounce)}),this._sessionExpiryTime=e.sessionExpiryTime||18e5,this._sessionExpiryDebounce=e.sessionExpiryDebounce||5e3,this._sessionExpiryDebounceThresholdPercentage=e.sessionExpiryDebounceThresholdPercentage||.9,this._onNewSessionStarted=e.onNewSessionStarted?e.onNewSessionStarted:Or,this._safeLocalStorage=new Yt}getCurrentSessionId(){const e=this._safeLocalStorage.getItem("session.id"),t=parseInt(this._safeLocalStorage.getItem("session.expiry")||"0",10)||0;return this._debouncedUpdateSessionExpiry(t),!e||t<=Date.now()||Number.isNaN(t)?this._generateNewSessionId():Ir.test(e)?e:this._generateNewSessionId()}}var Tr=class extends Jt{constructor(e){let t;try{t=window.sessionStorage||Qt}catch(e){t=Qt}super(t,e)}};class _r{constructor(){m()(this,"_generateNewTabId",()=>{const e=f()();return this._safeSessionStorage.setItem("tab.id",e),e}),this._safeSessionStorage=new Tr}getCurrentTabId(){let e=this._safeSessionStorage.getItem("tab.id");return e||(e=this._generateNewTabId()),e}}function Sr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function kr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Sr(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const Ar="taskSessionsInit";class Pr{constructor(){m()(this,"_taskSessionsNotRecentlyInitialised",e=>null===this._safeSessionStorage.getItem("taskSessions")||null===this._safeSessionStorage.getItem(Ar)||parseInt(this._safeSessionStorage.getItem(Ar)||"0",10)<e-3e3),m()(this,"_removeTaskSessionPrefix",(e,t)=>t.split("awc.")[1]),m()(this,"_isTaskSessionQueryParam",(e,t)=>t.startsWith("awc.")),m()(this,"getAllTaskSessions",()=>{try{return JSON.parse(this._safeSessionStorage.getItem("taskSessions")||"")}catch(e){return{}}}),m()(this,"_writeToSessionStorage",e=>{try{this._safeSessionStorage.setItem("taskSessions",JSON.stringify(e))}catch(e){}}),m()(this,"_appendTaskSessions",e=>{const t=this.getAllTaskSessions(),r=null===t?e:Object.assign(t,e);this._writeToSessionStorage(r)}),m()(this,"_safelyRemoveKey",(e,t)=>null===e?{}:(delete e[t],e)),m()(this,"createTaskSession",e=>{const t=f()(),r={};return r[e]=t,this._appendTaskSessions(r),t}),m()(this,"createTaskSessionWithProvidedId",(e,t)=>{if("string"!=typeof t)throw new TypeError("invalid taskSessionId, must be string");const r={};r[e]=t,this._appendTaskSessions(r)}),m()(this,"completeTaskSession",e=>{const t=this.getAllTaskSessions(),r=this._safelyRemoveKey(t,e);this._writeToSessionStorage(r)}),m()(this,"formatTaskSessionQueryString",({uri:e,includedTaskSessions:t})=>{const{url:r,query:s}=Object(fr.parseUrl)(e),i=this.getAllTaskSessions(),n=t?(o=i,t.reduce((e,t)=>(t in o&&(e[t]=o[t]),e),{})):ne(i,Object.values(_));var o;if(0===Object.keys(n).length)return e;const a=kr(kr({},ie(n,(e,t)=>"awc."+t)),s);return`${r}?${Object(fr.stringify)(a)}`}),m()(this,"stripQueryParameters",()=>{const e=ie(br(this._isTaskSessionQueryParam),this._removeTaskSessionPrefix);this._appendTaskSessions(e)});const e=Date.now();this._safeSessionStorage=new Tr;try{this._taskSessionsNotRecentlyInitialised(e)&&(this._writeToSessionStorage({}),this._safeSessionStorage.setItem(Ar,e.toString()))}catch(e){}}}const Dr=Vt.AWC_ANALYTICS_DEBUG.getKey();var Cr=class{constructor(){m()(this,"_bind",()=>{"undefined"==typeof window||window.testAnalytics||(window.testAnalytics={eventCache:[],events:()=>window.testAnalytics.eventCache,clear:()=>{window.testAnalytics.eventCache=[];try{localStorage.removeItem("awc.ui.viewed.last.sent"),localStorage.removeItem("awc-staging.ui.viewed.last.sent"),localStorage.removeItem("awc-dev.ui.viewed.last.sent"),localStorage.removeItem("awc-local.ui.viewed.last.sent")}catch(e){}}})}),m()(this,"_cache",e=>{"undefined"!=typeof window&&(window.testAnalytics.eventCache.length>=100&&(window.testAnalytics.eventCache=window.testAnalytics.eventCache.slice(1,window.testAnalytics.eventCache.length)),window.testAnalytics.eventCache.push(e))}),m()(this,"_shouldCacheEvent",()=>this._isDebugCookieEnabled),m()(this,"saveEvent",e=>{e&&this._shouldCacheEvent()&&(window.testAnalytics||this._bind(),e.tags instanceof Array?e.tags.push("synthetic"):e.tags=["synthetic"],this._cache(e))}),this._isDebugCookieEnabled=(()=>{try{return JSON.parse(Gt.a.get(Dr)||"false")}catch(e){Gt.a.remove(Dr)}return!1})(),this._isDebugCookieEnabled&&this._bind()}};const jr=["embeddedProduct"];function Nr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Mr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Nr(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class Rr{constructor(e,t,r,s={}){if(m()(this,"start",()=>{this._startInterval(),this._bindEventListeners()}),m()(this,"stop",()=>{this._stopInterval(),this._unbindEventListeners()}),m()(this,"resetTimers",()=>{this._intervalId&&(this.stop(),this.start())}),m()(this,"_bindEventListeners",()=>{"undefined"!=typeof window&&(window.addEventListener("focus",this._focusListener),window.addEventListener("blur",this._blurListener))}),m()(this,"_unbindEventListeners",()=>{"undefined"!=typeof window&&(window.removeEventListener("focus",this._focusListener),window.removeEventListener("blur",this._blurListener))}),m()(this,"_startInterval",()=>{clearInterval(this._intervalId),this._intervalId=setInterval(this._handleInterval,this._delay)}),m()(this,"_stopInterval",()=>{this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null)}),m()(this,"_getProductKey",(e,t)=>{let r=e;return t&&(r+="-"+t),r}),m()(this,"_getLastSentTimestamp",(e,t,r)=>(((this._parseLocalStorageData()||{})[r]||{})[t]||{})[e]||null),m()(this,"_parseLocalStorageData",()=>{const e=this._safeLocalStorage.getItem(this._storageKey);try{return JSON.parse(e||"")}catch(e){return this._safeLocalStorage.removeItem(this._storageKey),null}}),m()(this,"_setLastSentTimestamp",(e,t,r)=>{const s=this._parseLocalStorageData()||{},i=s[r]||{},n=i[t]||{};n[e]=Date.now(),i[t]=n,s[r]=i,this._safeLocalStorage.setItem(this._storageKey,JSON.stringify(s))}),m()(this,"_shouldSendEvent",(e,t,r,s)=>{if(!document.hasFocus())return!1;if(t!==w.NONE&&!r||!s)return!1;return Date.now()-this._getLastSentTimestamp(e,r,s)>this._throttle}),m()(this,"_handleInterval",()=>{const e=this._getContext(),{embeddedProduct:t}=e,r=Ue()(e,jr);this._sendEvent(this._product,r),t&&this._sendEvent(t,r,!0)}),m()(this,"_sendEvent",(e,t,r=!1)=>{const{subproduct:s,tenantIdType:i,tenantId:n,userId:o,lastScreenEvent:a,attributes:c}=t,l=this._getProductKey(e,s);if(this._shouldSendEvent(l,i,n,o)){this._setLastSentTimestamp(l,n,o);const t=this._createEvent(e,s,r,a,c);this._onEvent(t)}}),m()(this,"_createEvent",(e,t,r,s,i)=>{const n={product:e,source:"ui",action:"viewed",actionSubject:"ui",attributes:i};return r&&(n.subproduct=null,n.version=null,n.attributes=Mr(Mr({},n.attributes),{},{embeddedInEnv:this._productInfo.env,embeddedInProduct:this._productInfo.product,embeddedInSubproduct:t,embeddedInVersion:this._productInfo.version,embeddedInOrigin:this._productInfo.origin,embeddedInPlatform:this._productInfo.platform})),s&&(n.attributes=Mr(Mr({},n.attributes),{},{lastScreenEvent:{name:s.name,attributes:s.attributes}})),n}),!e)throw new Error("Missing productInfo");if(!e.product)throw new Error("Missing productInfo.product");if(!t)throw new Error("Missing getContext callback");if("function"!=typeof t)throw new Error("Invalid getContext, must be function");if(!r)throw new Error("Missing onEvent callback");if("function"!=typeof r)throw new Error("Invalid onEvent, must be function");this._productInfo=e,this._product=e.product,this._getContext=t,this._onEvent=r,this._delay=s.delay||2e3,this._throttle=s.throttle||36e5,this._storageKey=s.storageKey||"ui.viewed.last.sent",this._safeLocalStorage=new Yt({envPrefix:this._productInfo.env}),this._focusListener=()=>{this._startInterval()},this._blurListener=()=>{this._stopInterval()}}}function Lr(e,t){return e&&"function"==typeof e?()=>{e(t)}:null}let xr=function(e){return e.XC="xc",e.UID="uid",e}({});const Ur=(e,t)=>{if(e&&t&&"function"==typeof t){const e=()=>new Promise(e=>{setTimeout(()=>e(()=>[{type:xr.XC,state:"TIMEOUT"},{type:xr.UID,state:"TIMEOUT"}]),5e3)}),r=()=>t().catch(()=>()=>[{type:xr.XC,state:"UNKNOWN"},{type:xr.UID,state:"UNKNOWN"}]);return Promise.race([r(),e()])}};function Fr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Br(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Fr(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const Hr="/gateway/api/gasv3/api/v1";class $r{constructor(e,t={}){if(m()(this,"_useStargate",e=>null==e||e),m()(this,"_endsWith",(e,t)=>-1!==e.indexOf(t,e.length-t.length)),m()(this,"_changeInternalUserId",(e,t)=>{this.eventProcessor.getUser().setUserId(e),t&&t!==this.eventProcessor.getUser().getAnonymousId()&&this.eventProcessor.getUser().setAnonymousId(t)}),m()(this,"_createSubproductGetter",e=>x(e,"Cannot get subproduct from the callback. Proceeding without it.")),m()(this,"_createEmbeddedProductGetter",e=>x(e,"Cannot get embeddedProduct from the callback. Proceeding without it.")),m()(this,"_getLastScreenEvent",()=>{try{return JSON.parse(this._safeSessionStorage.getItem("last.screen.event")||"")}catch(e){return this._safeSessionStorage.removeItem("last.screen.event"),null}}),m()(this,"_setLastScreenEvent",e=>{this._safeSessionStorage.setItem("last.screen.event",JSON.stringify({name:e.name,attributes:e.attributes}))}),m()(this,"_shouldEventBeDelayed",e=>{if(!e.tags||-1===e.tags.indexOf("measurement"))return!1;const t=!1!==e.highPriority;return this.eventDelayQueue.isDelayingLowPriorityEvents()&&!t}),m()(this,"_fireEvent",(e,t,r,s)=>{switch(t.eventType){case b.UI:case b.OPERATIONAL:case b.TRACK:return this.eventProcessor.track(e,t,r,s);case b.SCREEN:return this.eventProcessor.page(e,t,r,s);case b.IDENTIFY:return this.eventProcessor.identify(e,t,r,s);default:throw new Error("No handler has been defined for events of type "+t.eventType)}}),m()(this,"_fireDelayedEvent",(e,t,r,s)=>{try{this._changeInternalUserId(s.userId,s.anonymousId),t.tags=[...t.tags||[],"sentWithDelay"],this._fireEvent(e,t,r,void 0)}finally{this._changeInternalUserId(this._userInfo.userId,this._userInfo.anonymousId)}}),m()(this,"_delayEvent",(e,t,r,s,i)=>{this.eventDelayQueue.push(e,t,r,s),i&&i()}),m()(this,"_processEvent",(e,t,r,s)=>(this._testingCache.saveEvent(t),this._shouldEventBeDelayed(t)?(this._delayEvent(e,t,r,this._userInfo,s),Promise.resolve()):this._fireEvent(e,t,r,s))),m()(this,"setEmbeddedProduct",e=>{this._productInfo.embeddedProduct=this._createEmbeddedProductGetter(e),this.resetUIViewedTimers()}),m()(this,"clearEmbeddedProduct",()=>{this._productInfo.embeddedProduct=this._createEmbeddedProductGetter(null)}),m()(this,"setSubproduct",e=>{this._productInfo.subproduct=this._createSubproductGetter(e),this.resetUIViewedTimers()}),m()(this,"setOriginTracingHandlers",e=>{const t=this.originTracing.handleOriginParameters(e,this._historyReplaceFn);Object.keys(t).forEach(e=>{void 0!==t[e].taskSessionId&&this.task.createTaskSessionWithProvidedId(e,t[e].taskSessionId)});const r={};return Object.keys(t).forEach(e=>{t[e].originTracingAttributes?r[e]=t[e].originTracingAttributes:console.warn(`Handling method for origin parameter ${e} has not returned any attributes`)}),Object.keys(t).length>0?this.sendOperationalEvent({action:"landed",actionSubject:"origin",source:"webClient",attributes:{originTracesLanded:r}},()=>{}):Promise.resolve()}),m()(this,"setTenantInfo",(e,t)=>{if(!e)throw new Error("Missing tenantIdType");if(e!==w.NONE&&!t)throw new Error("Missing tenantId");if(!k(w,e))throw new Error(`Invalid tenantIdType '${e}', must be an tenantType: [${S(w)}]`);this._tenantInfo={tenantIdType:e,tenantId:t}}),m()(this,"clearTenantInfo",()=>{this._tenantInfo={}}),m()(this,"setOrgInfo",e=>{if(!e)throw new Error("Missing orgId");this._orgInfo={orgId:e}}),m()(this,"clearOrgInfo",()=>{this._orgInfo={}}),m()(this,"setWorkspaceInfo",e=>{if(!e)throw new Error("Missing workspaceId");this._workspaceInfo={workspaceId:e}}),m()(this,"clearWorkspaceInfo",()=>{this._workspaceInfo={}}),m()(this,"setUserInfo",(e,t)=>{!function(e,t){if(!e)throw new Error("Missing userIdType");if(!t)throw new Error("Missing userId");if(!k(I,e))throw new Error(`Invalid userIdType '${e}', must be an userType: [${S(I)}]`)}(e,t),this._changeInternalUserId(t),this._userInfo={userIdType:e,userId:t,anonymousId:this.eventProcessor.getUser().getAnonymousId()}}),m()(this,"clearUserInfo",()=>{this._changeInternalUserId(void 0),this._userInfo={anonymousId:this.eventProcessor.getUser().getAnonymousId()}}),m()(this,"setAlias",(e,t)=>{if(!e)throw new Error("Missing aliasType");if(!k(P,e))throw new Error(`Invalid aliasType '${e}', must be an aliasType: [${S(P)}]`);this._aliases[e]=t}),m()(this,"clearAlias",()=>{this._aliases={}}),m()(this,"setGroup",(e,t)=>{if(!e)throw new Error("Missing groupType");if(!k(D,e))throw new Error(`Invalid groupType '${e}', must be an groupType: [${S(D)}]`);this._groups[e]=t}),m()(this,"clearGroup",()=>{this._groups={}}),m()(this,"getAnonymousId",()=>this._userInfo.anonymousId),m()(this,"setUIViewedAttributes",e=>{if(!e)throw new Error("Missing uiViewedAttributes");if("object"!=typeof e||Array.isArray(e))throw new Error("Invalid uiViewedAttributes type, should be a non array object");this._uiViewedAttributes=Br({},e)}),m()(this,"getUIViewedAttributes",()=>this._uiViewedAttributes),m()(this,"clearUIViewedAttributes",()=>{this._uiViewedAttributes={}}),m()(this,"sendIdentifyEvent",(e,t,r)=>{this.setUserInfo(e,t);const s={userIdType:e,eventType:b.IDENTIFY};return this._processEvent(t,s,this._context,r)}),m()(this,"sendPageEvent",(e,t)=>this.sendScreenEvent(e,t)),m()(this,"sendScreenEvent",(e,t,r)=>{let s,i,n,o;"object"==typeof e?(s=e.name,i=e.attributes,n=e.containers,o=e.tags):(s=e,i=r),function(e){if(!e)throw new Error("Missing name")}(s),le(n);const a=Br({name:s},te(this._productInfo,this._tenantInfo,this._userInfo,i,e.nonPrivacySafeAttributes,o,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this.task.getAllTaskSessions(),this._orgInfo,this._pageLoadId,this._workspaceInfo,e,n,this._aliases,this._groups));return this._setLastScreenEvent(a),this._processEvent(s,a,this._context,Lr(t,a))}),m()(this,"sendTrackEvent",(e,t)=>{!function(e){de(e)}(e);const r=se(this._productInfo,this._tenantInfo,this._userInfo,e,b.TRACK,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this.task.getAllTaskSessions(),this._orgInfo,this._pageLoadId,this._workspaceInfo,this._aliases,this._groups);return this._processEvent(re(e),r,this._context,Lr(t,r))}),m()(this,"sendUIEvent",(e,t)=>{!function(e){de(e)}(e);const r=se(this._productInfo,this._tenantInfo,this._userInfo,e,b.UI,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this.task.getAllTaskSessions(),this._orgInfo,this._pageLoadId,this._workspaceInfo,this._aliases,this._groups);return this._processEvent(re(e),r,this._context,Lr(t,r))}),m()(this,"sendOperationalEvent",(e,t)=>{!function(e){de(e)}(e);const r=se(this._productInfo,this._tenantInfo,this._userInfo,e,b.OPERATIONAL,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this.task.getAllTaskSessions(),this._orgInfo,this._pageLoadId,this._workspaceInfo,this._aliases,this._groups);return this._processEvent(re(e),r,this._context,Lr(t,r))}),m()(this,"startUIViewedEvent",e=>{this.stopUIViewedEvent(),this._uiViewedEvent=new Rr(this._productInfo,()=>({embeddedProduct:this._productInfo.embeddedProduct(),subproduct:this._productInfo.subproduct(),tenantIdType:this._tenantInfo.tenantIdType,tenantId:this._tenantInfo.tenantId,userId:this._userInfo.userId,lastScreenEvent:this._getLastScreenEvent(),attributes:this._uiViewedAttributes}),t=>this.sendUIEvent(t,e)),this._uiViewedEvent.start()}),m()(this,"stopUIViewedEvent",()=>{this._uiViewedEvent&&(this._uiViewedEvent.stop(),this._uiViewedEvent=null)}),m()(this,"resetUIViewedTimers",()=>{this._uiViewedEvent&&this._uiViewedEvent.resetTimers()}),m()(this,"startApdexEvent",e=>{this._apdexEvent.start(e)}),m()(this,"getApdexStart",e=>this._apdexEvent.getStart(e)),m()(this,"stopApdexEvent",(e,t)=>{this._apdexEvent.stop(e,t)}),m()(this,"startLowPriorityEventDelay",(e,t)=>{this.eventDelayQueue.startLowPriorityEventDelay(e,t)}),m()(this,"stopLowPriorityEventDelay",()=>{this.eventDelayQueue.stopLowPriorityEventDelay()}),m()(this,"onEvent",(e,t)=>{if(!t)throw new Error("Missing analyticsData");if(!t.eventType)throw new Error("Missing analyticsData.eventType");if(t.eventType===b.TRACK)return this.sendTrackEvent(t);if(t.eventType===b.UI)return this.sendUIEvent(t);if(t.eventType===b.OPERATIONAL)return this.sendOperationalEvent(t);if(t.eventType===b.SCREEN)return this.sendScreenEvent(t.name,null,t.attributes);if(t.eventType===b.IDENTIFY)return this.sendIdentifyEvent(t.userIdType,t.userId);throw new Error(`Invalid analyticsData.eventType '${t.eventType}', must be an eventType: [${S(b)}]`)}),!e)throw new Error("Missing productInfo");if(!e.env)throw new Error("Missing productInfo.env");if(!e.product)throw new Error("Missing productInfo.product");if(!k(g,e.env))throw new Error(`Invalid productInfo.env '${e.env}', must be an envType: [${S(g)}]`);if(e.perimeter&&!k(A,e.perimeter))throw new Error(`Invalid productInfo.perimeter '${e.perimeter}', must be an perimeterType: [${S(A)}]`);if(e.origin){if(!k(v,e.origin))throw new Error(`Invalid productInfo.origin '${e.origin}', must be an originType: [${S(v)}]`)}else e.origin=v.WEB;e.platform?function(e){if(!k(y,e.platform))throw new Error(`Invalid productInfo.platform '${e.platform}', must be a platformType: [${S(y)}]`);if(e.origin===v.DESKTOP&&!k(E,e.platform))throw new Error(`Invalid productInfo.platform '${e.platform}', must be one of [mac, linux, windows]`);if(e.origin===v.WEB&&!k(T,e.platform))throw new Error(`Invalid productInfo.platform '${e.platform}', must be one of [web, mobileWeb]`)}(e):e.platform=e.origin===v.WEB?y.WEB:y.DESKTOP,this.logger=t.logger||console,this._productInfo=Br(Br({},e),{},{subproduct:this._createSubproductGetter(e.subproduct),embeddedProduct:this._createEmbeddedProductGetter(e.embeddedProduct)}),this._tenantInfo={},this._orgInfo={},this._uiViewedAttributes={},this._context=function(e){const t=window.screen||{};return{context:{locale:e.locale,screen:{width:t.width,height:t.height,density:window.devicePixelRatio},library:{name:"analytics.js",version:"4.23.0"}}}}(this._productInfo),this._safeSessionStorage=new Tr;const r=this._useStargate(t.useStargate),s=t.apiHost||wr({useStargate:r,env:e.env,useLegacyUrl:t.useLegacyUrl,perimeter:e.perimeter,envOverride:e.envOverride}),i=t.apiHostProtocol||"https",n={maxRetryDelay:6e4,minRetryDelay:t.minRetryDelay||1e3,backoffFactor:2,flushWaitMs:t.flushWaitInterval,flushBeforeUnload:t.flushBeforeUnload},o="awc-"+e.env,a=t.disableCookiePersistence||!1;this.eventProcessor=new pr({apiHost:s,apiHostProtocol:i,product:e.product,retryQueuePrefix:o,retryQueueOptions:n,xidPromiseGetter:()=>Ur(t.xidConsent,t.xidPromiseFn),logger:this.logger,disableCookiePersistence:a}),this._userInfo={anonymousId:this.eventProcessor.getUser().getAnonymousId(null==t?void 0:t.customAnonymousIdGenerator)},this._pageVisibility=new j,this._tabTracking=new _r,this._sessionTracking=new Er({sessionExpiryTime:t.sessionExpiryTime,onNewSessionStarted:t.onNewSessionStarted}),this.task=new Pr,this.originTracing=new yr,this._apdexEvent=new L(this.sendOperationalEvent,this._pageVisibility),this._historyReplaceFn="function"==typeof t.historyReplaceFn?t.historyReplaceFn:gr,this.eventDelayQueue=new ve(this._fireDelayedEvent,t.delayQueueCompressors||[]),this._testingCache=new Cr,this._pageLoadId=f()(),this._workspaceInfo={},this._aliases={},this._groups={}}}var Wr=r(395),Gr=r.n(Wr);function Kr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function zr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Kr(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const Vr={initialPollInterval:5,pollBackoffRate:2,idleTimeout:30};class Qr{constructor(e,t,r,s){if(m()(this,"timeMeInitialized",!1),m()(this,"start",()=>{if(this.timeMeInitialized)throw new Error("DwellTimeHelper should only be initialised once per page load.");this.timeMeInitialized=!0,this._initDwellTimeCounterAndPolling(),"undefined"!=typeof window&&window.addEventListener("beforeunload",()=>{this.stop()})}),m()(this,"stop",()=>{Gr.a.isUserCurrentlyOnPage&&this._sendDwellEvent(this._eventData,this._searchSessionId,!0),Gr.a.stopAllTimers(),Gr.a.resetAllRecordedPageTimes(),Gr.a.timeElapsedCallbacks=[],this.timeMeInitialized=!1}),m()(this,"newPage",(e,t)=>{he(e),this.stop(),this._eventData=e,this._searchSessionId=t,this._initDwellTimeCounterAndPolling()}),m()(this,"_initDwellTimeCounterAndPolling",()=>{Gr.a.initialize({idleTimeoutInSeconds:this._timing.idleTimeout}),this._pollDwellTime(this._timing.initialPollInterval,this._searchSessionId,this._eventData)}),m()(this,"_pollDwellTime",(e,t,r)=>{Gr.a.callAfterTimeElapsedInSeconds(e,()=>{this._sendDwellEvent(r,t,!1),this._pollDwellTime(e*this._timing.pollBackoffRate,t,r)})}),m()(this,"_sendDwellEvent",(e,t,r)=>{const s={dwellTime:Gr.a.getTimeOnCurrentPageInMilliseconds(),searchReferrer:t,finalDwellEvent:r};this._trackCallback({action:"dwelled",actionSubject:e.actionSubject,actionSubjectId:e.actionSubjectId,source:e.source,containerType:e.containerType,containerId:e.containerId,containers:e.containers,objectType:e.objectType,objectId:e.objectId,attributes:zr(zr({},s),e.attributes),tags:e.tags})}),!e)throw new Error("trackCallback is required for DwellTimeHelper");he(t),this._trackCallback=e,this._eventData=t,this._searchSessionId=r,this._timing=zr(zr({},Vr),s)}}var qr=r(1339);function Jr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Yr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Jr(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const Xr={initialPollInterval:5e3,idleTimeout:3e4,multiplierCallback:e=>e+e};class Zr{constructor(e,t,r,s){if(m()(this,"start",()=>{this.browserInteractionTime.startTimer(),this.browserInteractionTime.addTimeIntervalEllapsedCallback({callback:e=>this._sendDwellEvent(this._eventData,this._searchSessionId,e,!1),timeInMilliseconds:this._timing.initialPollInterval,multiplier:this._timing.multiplierCallback}),"undefined"!=typeof window&&window.addEventListener("beforeunload",this._onBeforeUnload)}),m()(this,"stop",()=>{this.browserInteractionTime.isRunning()&&this._sendDwellEvent(this._eventData,this._searchSessionId,this.browserInteractionTime.getTimeInMilliseconds(),!0),this.browserInteractionTime.stopTimer()}),m()(this,"newPage",(e,t)=>{he(e),this.stop(),this.browserInteractionTime.reset(),this.setEventData(e),this.setSearchSessionId(t),this.start()}),m()(this,"setEventData",e=>{this._eventData=e}),m()(this,"getEventData",()=>this._eventData),m()(this,"setSearchSessionId",e=>{this._searchSessionId=e}),m()(this,"getSearchSessionId",()=>this._searchSessionId),m()(this,"destroy",()=>{this.browserInteractionTime.destroy(),"undefined"!=typeof window&&window.removeEventListener("beforeunload",this._onBeforeUnload)}),m()(this,"_onBeforeUnload",()=>{this.stop(),this.destroy()}),m()(this,"_sendDwellEvent",(e,t,r,s)=>{const i={dwellTime:r,searchReferrer:t,finalDwellEvent:s};this._trackCallback({action:"dwelled",actionSubject:e.actionSubject,actionSubjectId:e.actionSubjectId,source:e.source,containerType:e.containerType,containerId:e.containerId,objectType:e.objectType,objectId:e.objectId,attributes:Yr(Yr({},i),e.attributes),tags:e.tags})}),!e)throw new Error("trackCallback is required for DwellTimeHelper");he(t),this._trackCallback=e,this._eventData=t,this._searchSessionId=r,this._timing=Yr(Yr({},Xr),s),this.browserInteractionTime=new qr.a({idleTimeoutMs:this._timing.idleTimeout,checkCallbacksIntervalMs:500})}}function es(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function ts(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?es(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):es(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function rs(e,t,r){const s=ts({action:e},r);return s.attributes=ts(ts({},t),s.attributes),s}class ss{constructor(e,t){this._onEvent=e,this._baseEvent=t,this._searchStartedTime=null,this._lastQueryResultsTime=null,this._queryLength=null,this._baseEvent=ts({},t)}search(e){if(!e&&""!==e)throw new Error("Missing query param");this._searchStartedTime=Date.now(),this._queryLength=(e||"").length}searched(e){if(!e)throw new Error("Missing results param");if(null===this._queryLength)throw new Error("search() must be called before searched().");const t=Date.now()-this._searchStartedTime;this._lastQueryResultsTime=Date.now(),this._lastResults=e;const r=rs("searched",{responseTimeMs:t,queryLength:this._queryLength,results:e},this._baseEvent);this._onEvent(r)}selected(e){if(!e&&0!==e)throw new Error("Missing selectionIndex param");if(!this._lastQueryResultsTime)throw new Error("searched() must be called before selected().");const t=Date.now(),r=t-this._lastQueryResultsTime,s=t-this._searchStartedTime,i=this._lastResults[e],n=rs("selected",{queryLength:this._queryLength,selectionIndex:e,selectionTimeMs:r,searchTimeMs:s,selectedResultValue:i},this._baseEvent);this._onEvent(n)}}void 0!==window.awc_resolve&&null!==window.awc_resolve||(window.awc=new Promise((function(e,t){window.awc_resolve=e}))),window.awc_resolve(s),Object.assign(window,{Bloodhound:n.a,Strftime:a.a,_:l.a,typeahead:d.a})},395:function(e,t,r){var s;(()=>{((r,i)=>{if(e.exports)return e.exports=i();void 0===(s=(()=>r.TimeMe=i()).apply(t,[]))||(e.exports=s)})(this,()=>{let e={startStopTimes:{},idleTimeoutMs:3e4,currentIdleTimeMs:0,checkIdleStateRateMs:250,isUserCurrentlyOnPage:!0,isUserCurrentlyIdle:!1,currentPageName:"default-page-name",timeElapsedCallbacks:[],userLeftCallbacks:[],userReturnCallbacks:[],trackTimeOnElement:t=>{let r=document.getElementById(t);r&&(r.addEventListener("mouseover",()=>{e.startTimer(t)}),r.addEventListener("mousemove",()=>{e.startTimer(t)}),r.addEventListener("mouseleave",()=>{e.stopTimer(t)}),r.addEventListener("keypress",()=>{e.startTimer(t)}),r.addEventListener("focus",()=>{e.startTimer(t)}))},getTimeOnElementInSeconds:t=>{let r=e.getTimeOnPageInSeconds(t);return r||0},startTimer:(t,r)=>{if(t||(t=e.currentPageName),void 0===e.startStopTimes[t])e.startStopTimes[t]=[];else{let r=e.startStopTimes[t],s=r[r.length-1];if(void 0!==s&&void 0===s.stopTime)return}e.startStopTimes[t].push({startTime:r||new Date,stopTime:void 0})},stopAllTimers:()=>{let t=Object.keys(e.startStopTimes);for(let r=0;r<t.length;r++)e.stopTimer(t[r])},stopTimer:(t,r)=>{t||(t=e.currentPageName);let s=e.startStopTimes[t];void 0!==s&&0!==s.length&&void 0===s[s.length-1].stopTime&&(s[s.length-1].stopTime=r||new Date)},getTimeOnCurrentPageInSeconds:()=>e.getTimeOnPageInSeconds(e.currentPageName),getTimeOnPageInSeconds:t=>{let r=e.getTimeOnPageInMilliseconds(t);return void 0===r?void 0:r/1e3},getTimeOnCurrentPageInMilliseconds:()=>e.getTimeOnPageInMilliseconds(e.currentPageName),getTimeOnPageInMilliseconds:t=>{let r=0,s=e.startStopTimes[t];if(void 0===s)return;let i=0;for(let e=0;e<s.length;e++){let t=s[e].startTime,r=s[e].stopTime;void 0===r&&(r=new Date),i+=r-t}return r=Number(i),r},getTimeOnAllPagesInSeconds:()=>{let t=[],r=Object.keys(e.startStopTimes);for(let s=0;s<r.length;s++){let i=r[s],n=e.getTimeOnPageInSeconds(i);t.push({pageName:i,timeOnPage:n})}return t},setIdleDurationInSeconds:t=>{let r=parseFloat(t);if(!1!==isNaN(r))throw{name:"InvalidDurationException",message:"An invalid duration time ("+t+") was provided."};e.idleTimeoutMs=1e3*t},setCurrentPageName:t=>{e.currentPageName=t},resetRecordedPageTime:t=>{delete e.startStopTimes[t]},resetAllRecordedPageTimes:()=>{let t=Object.keys(e.startStopTimes);for(let r=0;r<t.length;r++)e.resetRecordedPageTime(t[r])},userActivityDetected:()=>{e.isUserCurrentlyIdle&&e.triggerUserHasReturned(),e.resetIdleCountdown()},resetIdleCountdown:()=>{e.isUserCurrentlyIdle=!1,e.currentIdleTimeMs=0},callWhenUserLeaves:(t,r)=>{e.userLeftCallbacks.push({callback:t,numberOfTimesToInvoke:r})},callWhenUserReturns:(t,r)=>{e.userReturnCallbacks.push({callback:t,numberOfTimesToInvoke:r})},triggerUserHasReturned:()=>{if(!e.isUserCurrentlyOnPage){e.isUserCurrentlyOnPage=!0,e.resetIdleCountdown();for(let t=0;t<e.userReturnCallbacks.length;t++){let r=e.userReturnCallbacks[t],s=r.numberOfTimesToInvoke;(isNaN(s)||void 0===s||s>0)&&(r.numberOfTimesToInvoke-=1,r.callback())}}e.startTimer()},triggerUserHasLeftPageOrGoneIdle:()=>{if(e.isUserCurrentlyOnPage){e.isUserCurrentlyOnPage=!1;for(let t=0;t<e.userLeftCallbacks.length;t++){let r=e.userLeftCallbacks[t],s=r.numberOfTimesToInvoke;(isNaN(s)||void 0===s||s>0)&&(r.numberOfTimesToInvoke-=1,r.callback())}}e.stopAllTimers()},callAfterTimeElapsedInSeconds:(t,r)=>{e.timeElapsedCallbacks.push({timeInSeconds:t,callback:r,pending:!0})},checkIdleState:()=>{for(let t=0;t<e.timeElapsedCallbacks.length;t++)e.timeElapsedCallbacks[t].pending&&e.getTimeOnCurrentPageInSeconds()>e.timeElapsedCallbacks[t].timeInSeconds&&(e.timeElapsedCallbacks[t].callback(),e.timeElapsedCallbacks[t].pending=!1);!1===e.isUserCurrentlyIdle&&e.currentIdleTimeMs>e.idleTimeoutMs?(e.isUserCurrentlyIdle=!0,e.triggerUserHasLeftPageOrGoneIdle()):e.currentIdleTimeMs+=e.checkIdleStateRateMs},visibilityChangeEventName:void 0,hiddenPropName:void 0,listenForVisibilityEvents:(t,r)=>{t&&e.listenForUserLeavesOrReturnsEvents(),r&&e.listForIdleEvents()},listenForUserLeavesOrReturnsEvents:()=>{void 0!==document.hidden?(e.hiddenPropName="hidden",e.visibilityChangeEventName="visibilitychange"):void 0!==document.mozHidden?(e.hiddenPropName="mozHidden",e.visibilityChangeEventName="mozvisibilitychange"):void 0!==document.msHidden?(e.hiddenPropName="msHidden",e.visibilityChangeEventName="msvisibilitychange"):void 0!==document.webkitHidden&&(e.hiddenPropName="webkitHidden",e.visibilityChangeEventName="webkitvisibilitychange"),document.addEventListener(e.visibilityChangeEventName,()=>{document[e.hiddenPropName]?e.triggerUserHasLeftPageOrGoneIdle():e.triggerUserHasReturned()},!1),window.addEventListener("blur",()=>{e.triggerUserHasLeftPageOrGoneIdle()}),window.addEventListener("focus",()=>{e.triggerUserHasReturned()})},listForIdleEvents:()=>{document.addEventListener("mousemove",()=>{e.userActivityDetected()}),document.addEventListener("keyup",()=>{e.userActivityDetected()}),document.addEventListener("touchstart",()=>{e.userActivityDetected()}),window.addEventListener("scroll",()=>{e.userActivityDetected()}),setInterval(()=>{!0!==e.isUserCurrentlyIdle&&e.checkIdleState()},e.checkIdleStateRateMs)},websocket:void 0,websocketHost:void 0,setUpWebsocket:t=>{if(window.WebSocket&&t){let r=t.websocketHost;try{e.websocket=new WebSocket(r),window.onbeforeunload=()=>{e.sendCurrentTime(t.appId)},e.websocket.onopen=()=>{e.sendInitWsRequest(t.appId)},e.websocket.onerror=e=>{console&&console.log("Error occurred in websocket connection: "+e)},e.websocket.onmessage=e=>{console&&console.log(e.data)}}catch(e){console&&console.error("Failed to connect to websocket host.  Error:"+e)}}},websocketSend:t=>{e.websocket.send(JSON.stringify(t))},sendCurrentTime:t=>{let r={type:"INSERT_TIME",appId:t,timeOnPageMs:e.getTimeOnCurrentPageInMilliseconds(),pageName:e.currentPageName};e.websocketSend(r)},sendInitWsRequest:t=>{let r={type:"INIT",appId:t};e.websocketSend(r)},initialize:t=>{let r=e.idleTimeoutMs||30,s=e.currentPageName||"default-page-name",i=void 0,n=void 0,o=!0,a=!0;t&&(r=t.idleTimeoutInSeconds||r,s=t.currentPageName||s,i=t.websocketOptions,n=t.initialStartTime,!1===t.trackWhenUserLeavesPage&&(o=!1),!1===t.trackWhenUserGoesIdle&&(a=!1)),e.setIdleDurationInSeconds(r),e.setCurrentPageName(s),e.setUpWebsocket(i),e.listenForVisibilityEvents(o,a),e.startTimer(void 0,n)}};return e})}).call(this)},508:function(e,t,r){"use strict";const s=r(852),i=r(853),n=r(854),o=r(1098),a=Symbol("encodeFragmentIdentifier");function c(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function l(e,t){return t.encode?t.strict?s(e):encodeURIComponent(e):e}function u(e,t){return t.decode?i(e):e}function d(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function h(e){const t=(e=d(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function m(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function p(e,t){c((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const r=function(e){let t;switch(e.arrayFormat){case"index":return(e,r,s)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===s[e]&&(s[e]={}),s[e][t[1]]=r):s[e]=r};case"bracket":return(e,r,s)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==s[e]?s[e]=[].concat(s[e],r):s[e]=[r]:s[e]=r};case"colon-list-separator":return(e,r,s)=>{t=/(:list)$/.exec(e),e=e.replace(/:list$/,""),t?void 0!==s[e]?s[e]=[].concat(s[e],r):s[e]=[r]:s[e]=r};case"comma":case"separator":return(t,r,s)=>{const i="string"==typeof r&&r.includes(e.arrayFormatSeparator),n="string"==typeof r&&!i&&u(r,e).includes(e.arrayFormatSeparator);r=n?u(r,e):r;const o=i||n?r.split(e.arrayFormatSeparator).map(t=>u(t,e)):null===r?r:u(r,e);s[t]=o};case"bracket-separator":return(t,r,s)=>{const i=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!i)return void(s[t]=r?u(r,e):r);const n=null===r?[]:r.split(e.arrayFormatSeparator).map(t=>u(t,e));void 0!==s[t]?s[t]=[].concat(s[t],n):s[t]=n};default:return(e,t,r)=>{void 0!==r[e]?r[e]=[].concat(r[e],t):r[e]=t}}}(t),s=Object.create(null);if("string"!=typeof e)return s;if(!(e=e.trim().replace(/^[?#&]/,"")))return s;for(const i of e.split("&")){if(""===i)continue;let[e,o]=n(t.decode?i.replace(/\+/g," "):i,"=");o=void 0===o?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?o:u(o,t),r(u(e,t),o,s)}for(const e of Object.keys(s)){const r=s[e];if("object"==typeof r&&null!==r)for(const e of Object.keys(r))r[e]=m(r[e],t);else s[e]=m(r,t)}return!1===t.sort?s:(!0===t.sort?Object.keys(s).sort():Object.keys(s).sort(t.sort)).reduce((e,t)=>{const r=s[t];return Boolean(r)&&"object"==typeof r&&!Array.isArray(r)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(r):e[t]=r,e},Object.create(null))}t.extract=h,t.parse=p,t.stringify=(e,t)=>{if(!e)return"";c((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const r=r=>t.skipNull&&null==e[r]||t.skipEmptyString&&""===e[r],s=function(e){switch(e.arrayFormat){case"index":return t=>(r,s)=>{const i=r.length;return void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?r:null===s?[...r,[l(t,e),"[",i,"]"].join("")]:[...r,[l(t,e),"[",l(i,e),"]=",l(s,e)].join("")]};case"bracket":return t=>(r,s)=>void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?r:null===s?[...r,[l(t,e),"[]"].join("")]:[...r,[l(t,e),"[]=",l(s,e)].join("")];case"colon-list-separator":return t=>(r,s)=>void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?r:null===s?[...r,[l(t,e),":list="].join("")]:[...r,[l(t,e),":list=",l(s,e)].join("")];case"comma":case"separator":case"bracket-separator":{const t="bracket-separator"===e.arrayFormat?"[]=":"=";return r=>(s,i)=>void 0===i||e.skipNull&&null===i||e.skipEmptyString&&""===i?s:(i=null===i?"":i,0===s.length?[[l(r,e),t,l(i,e)].join("")]:[[s,l(i,e)].join(e.arrayFormatSeparator)])}default:return t=>(r,s)=>void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?r:null===s?[...r,l(t,e)]:[...r,[l(t,e),"=",l(s,e)].join("")]}}(t),i={};for(const t of Object.keys(e))r(t)||(i[t]=e[t]);const n=Object.keys(i);return!1!==t.sort&&n.sort(t.sort),n.map(r=>{const i=e[r];return void 0===i?"":null===i?l(r,t):Array.isArray(i)?0===i.length&&"bracket-separator"===t.arrayFormat?l(r,t)+"[]":i.reduce(s(r),[]).join("&"):l(r,t)+"="+l(i,t)}).filter(e=>e.length>0).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[r,s]=n(e,"#");return Object.assign({url:r.split("?")[0]||"",query:p(h(e),t)},t&&t.parseFragmentIdentifier&&s?{fragmentIdentifier:u(s,t)}:{})},t.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0,[a]:!0},r);const s=d(e.url).split("?")[0]||"",i=t.extract(e.url),n=t.parse(i,{sort:!1}),o=Object.assign(n,e.query);let c=t.stringify(o,r);c&&(c="?"+c);let u=function(e){let t="";const r=e.indexOf("#");return-1!==r&&(t=e.slice(r)),t}(e.url);return e.fragmentIdentifier&&(u="#"+(r[a]?l(e.fragmentIdentifier,r):e.fragmentIdentifier)),`${s}${c}${u}`},t.pick=(e,r,s)=>{s=Object.assign({parseFragmentIdentifier:!0,[a]:!1},s);const{url:i,query:n,fragmentIdentifier:c}=t.parseUrl(e,s);return t.stringifyUrl({url:i,query:o(n,r),fragmentIdentifier:c},s)},t.exclude=(e,r,s)=>{const i=Array.isArray(r)?e=>!r.includes(e):(e,t)=>!r(e,t);return t.pick(e,i,s)}},61:function(e,t){e.exports=jQuery}},[[1908,1,0]]]);
//# sourceMappingURL=globals-f39f1afbe40d8b149e0b.chunk.js.map